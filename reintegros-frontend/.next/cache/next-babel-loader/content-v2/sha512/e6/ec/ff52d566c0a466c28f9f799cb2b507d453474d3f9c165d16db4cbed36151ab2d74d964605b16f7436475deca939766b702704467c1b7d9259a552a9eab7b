{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useEffect, useState } from 'react';\nimport useSWR from 'swr';\nimport { Box } from '@material-ui/core'; //App imports\n\nimport SolicitudesList from './SolicitudesList';\nimport { remove, put } from '../api-call/service';\nimport useLoading from '../common/hooks/Loading';\nimport useAlert from '../common/hooks/Alert';\nimport { FormStepper } from './Stepper';\nimport { useForm, FormProvider } from 'react-hook-form';\nimport { ERRORS, PRESTACIONES, SOLICITUDES } from '../../labels';\nimport { objToQueryString, formatDate, getUser, isUserAdmin, strToDate, isUserContaduria } from '../common/helpers';\nimport { addDays, format, parseISO } from 'date-fns';\nimport TableFilters from '../common/TableFilters';\nimport filterConfig from './FiltersConfig';\nimport Form from '../builder/Form';\nimport configPrestaciones from './prestaciones/FormConfig';\nimport Modal from '../common/Modal';\nexport default function Solicitudes() {\n  var _user$delegacionPrinc;\n\n  const user = getUser();\n  const INITIAL_FILTER = {\n    page: 1,\n    size: 20,\n    delegacion: isUserAdmin() || isUserContaduria() ? '' : (user === null || user === void 0 ? void 0 : (_user$delegacionPrinc = user.delegacionPrincipal) === null || _user$delegacionPrinc === void 0 ? void 0 : _user$delegacionPrinc.id) || '',\n    fecha_alta__gt: '',\n    fecha_alta__lt: ''\n  };\n  const {\n    0: filters,\n    1: setFilters\n  } = useState(_objectSpread({}, INITIAL_FILTER));\n  const {\n    0: filterQueryStr,\n    1: setFilterQueryStr\n  } = useState(objToQueryString(filters));\n  const {\n    data,\n    error: errorGet,\n    mutate\n  } = useSWR(`${SOLICITUDES.route}/?` + filterQueryStr);\n  const {\n    0: error,\n    1: setError\n  } = useState(errorGet);\n  const [showStepper, setShowStepper] = React.useState(false);\n  const methods = useForm({\n    mode: 'onBlur'\n  });\n  const {\n    isLoading,\n    unsetLoading\n  } = useLoading();\n  const {\n    addAlert,\n    removeAlert\n  } = useAlert();\n  const {\n    0: showFilters,\n    1: setShowFilters\n  } = useState(false);\n  const {\n    0: editPrestacion,\n    1: setEditPrestacion\n  } = useState(null);\n  useEffect(() => {\n    if (!data) {\n      if (errorGet) {\n        unsetLoading();\n        addAlert(ERRORS.onGet(SOLICITUDES.name), 'error');\n      } else {\n        isLoading();\n      }\n    } else {\n      unsetLoading();\n\n      if (!error) {\n        removeAlert();\n      } else {\n        addAlert(error, 'error');\n      }\n    }\n  }, [data, errorGet, error]);\n\n  const handleDelete = async id => {\n    try {\n      await remove(`${SOLICITUDES.route}`, id);\n    } catch (error) {\n      setError(ERRORS.onDeactivate(SOLICITUDES.name));\n    }\n\n    mutate(`${SOLICITUDES.route}?` + filterQueryStr);\n  };\n\n  const handleShowStepper = () => {\n    window.scrollTo(0, 0);\n    setShowStepper(true);\n  };\n\n  const handleFinished = () => {\n    mutate(`${SOLICITUDES.route}?${filterQueryStr}`);\n  };\n\n  const handleChangePagination = pagination => {\n    setFilters(_objectSpread(_objectSpread({}, filters), {}, {\n      page: pagination.page,\n      size: pagination.pageSize\n    }));\n  };\n\n  const handleFilter = filters => {\n    if (filters.fecha_alta__gt) {\n      filters.fecha_alta__gt = formatDate(filters.fecha_alta__gt);\n    } else {\n      delete filters.fecha_alta__gt;\n    }\n\n    if (filters.fecha_alta__lt) {\n      filters.fecha_alta__lt = formatDate(addDays(filters.fecha_alta__lt, 1));\n    } else {\n      delete filters.fecha_alta__lt;\n    }\n\n    setFilters(_objectSpread(_objectSpread({}, INITIAL_FILTER), filters));\n    setShowFilters(false);\n  };\n\n  const handleCancelFilter = () => {\n    setFilters(_objectSpread({}, INITIAL_FILTER));\n    setShowFilters(false);\n  };\n\n  const handleEditPrestacion = async data => {\n    var _data$nomenclador, _data$nomenclador$cap, _data$nomenclador2, _data$nomenclador2$ca, _data$nomenclador3, _data$nomenclador4, _data$nomenclador5, _data$nomenclador5$ca, _data$nomenclador6, _data$nomenclador6$ca, _data$nomenclador7, _data$prestador, _data$prestador2, _data$prestador3, _data$prestador4, _data$nomenclador8, _data$nomenclador9, _data$nomenclador10, _data$nomenclador11, _data$nomenclador12, _data$nomenclador12$c, _data$nomenclador13;\n\n    //TODO\n    const prestacion = _objectSpread(_objectSpread({}, data), {}, {\n      capitulo: {\n        label: (_data$nomenclador = data.nomenclador) === null || _data$nomenclador === void 0 ? void 0 : (_data$nomenclador$cap = _data$nomenclador.capitulo) === null || _data$nomenclador$cap === void 0 ? void 0 : _data$nomenclador$cap.descripcion,\n        value: (_data$nomenclador2 = data.nomenclador) === null || _data$nomenclador2 === void 0 ? void 0 : (_data$nomenclador2$ca = _data$nomenclador2.capitulo) === null || _data$nomenclador2$ca === void 0 ? void 0 : _data$nomenclador2$ca.capitulo\n      },\n      nomenclador: {\n        label: `${(_data$nomenclador3 = data.nomenclador) === null || _data$nomenclador3 === void 0 ? void 0 : _data$nomenclador3.codigo}-${(_data$nomenclador4 = data.nomenclador) === null || _data$nomenclador4 === void 0 ? void 0 : _data$nomenclador4.descripcion} (${(_data$nomenclador5 = data.nomenclador) === null || _data$nomenclador5 === void 0 ? void 0 : (_data$nomenclador5$ca = _data$nomenclador5.capitulo) === null || _data$nomenclador5$ca === void 0 ? void 0 : _data$nomenclador5$ca.capitulo}-${(_data$nomenclador6 = data.nomenclador) === null || _data$nomenclador6 === void 0 ? void 0 : (_data$nomenclador6$ca = _data$nomenclador6.capitulo) === null || _data$nomenclador6$ca === void 0 ? void 0 : _data$nomenclador6$ca.descripcion})`,\n        value: (_data$nomenclador7 = data.nomenclador) === null || _data$nomenclador7 === void 0 ? void 0 : _data$nomenclador7.id\n      },\n      prestador: {\n        label: `${(_data$prestador = data.prestador) === null || _data$prestador === void 0 ? void 0 : _data$prestador.matricula} - ${(_data$prestador2 = data.prestador) === null || _data$prestador2 === void 0 ? void 0 : _data$prestador2.nombre} ${(_data$prestador3 = data.prestador) === null || _data$prestador3 === void 0 ? void 0 : _data$prestador3.apellido}`,\n        value: (_data$prestador4 = data.prestador) === null || _data$prestador4 === void 0 ? void 0 : _data$prestador4.id\n      },\n      modalidad: (_data$nomenclador8 = data.nomenclador) === null || _data$nomenclador8 === void 0 ? void 0 : _data$nomenclador8.modalidadPrestacion,\n      valorIprossNomenclador: (_data$nomenclador9 = data.nomenclador) === null || _data$nomenclador9 === void 0 ? void 0 : _data$nomenclador9.valorIpross,\n      montoReintegrar: (parseFloat((_data$nomenclador10 = data.nomenclador) === null || _data$nomenclador10 === void 0 ? void 0 : _data$nomenclador10.valorIpross) - parseFloat((_data$nomenclador11 = data.nomenclador) === null || _data$nomenclador11 === void 0 ? void 0 : _data$nomenclador11.valorIpross) * (parseFloat((_data$nomenclador12 = data.nomenclador) === null || _data$nomenclador12 === void 0 ? void 0 : (_data$nomenclador12$c = _data$nomenclador12.capitulo) === null || _data$nomenclador12$c === void 0 ? void 0 : _data$nomenclador12$c.coseguro) / 100)).toFixed(2),\n      montoTotal: (_data$nomenclador13 = data.nomenclador) === null || _data$nomenclador13 === void 0 ? void 0 : _data$nomenclador13.valorIpross,\n      fechaPractica: strToDate(data.fechaPractica).toISOString(),\n      estadoActual: data.estadoActual || 'enCurso'\n    });\n\n    console.log('Edit solicitud', {\n      data,\n      prestacion\n    });\n    setEditPrestacion(prestacion);\n  };\n\n  const handleSubmitPrestacion = async data => {\n    var _data$nomenclador14, _data$nomenclador15, _data$prestador5, _data$prestador6, _editPrestacion$solic;\n\n    const prestacion = _objectSpread(_objectSpread({}, data), {}, {\n      nomenclador: (_data$nomenclador14 = data.nomenclador) !== null && _data$nomenclador14 !== void 0 && _data$nomenclador14.value ? (_data$nomenclador15 = data.nomenclador) === null || _data$nomenclador15 === void 0 ? void 0 : _data$nomenclador15.value : data.nomenclador,\n      prestador: (_data$prestador5 = data.prestador) !== null && _data$prestador5 !== void 0 && _data$prestador5.value ? (_data$prestador6 = data.prestador) === null || _data$prestador6 === void 0 ? void 0 : _data$prestador6.value : data.prestador,\n      fechaPractica: format(parseISO(data === null || data === void 0 ? void 0 : data.fechaPractica), 'yyyy-MM-dd'),\n      solicitud: (_editPrestacion$solic = editPrestacion.solicitud) === null || _editPrestacion$solic === void 0 ? void 0 : _editPrestacion$solic.id\n    });\n\n    try {\n      if (editPrestacion !== null && editPrestacion !== void 0 && editPrestacion.id) {\n        await put(PRESTACIONES.route, _objectSpread({}, prestacion), editPrestacion.id);\n      }\n\n      setError(null);\n      setEditPrestacion(null);\n    } catch (error) {\n      if (editPrestacion !== null && editPrestacion !== void 0 && editPrestacion.id) {\n        setError('onEdit');\n      } else {\n        setError('onCreate');\n      }\n    }\n  };\n\n  useEffect(() => {\n    setFilterQueryStr(objToQueryString(filters));\n  }, [filters]);\n  return /*#__PURE__*/_jsxs(Box, {\n    style: {\n      position: 'relative'\n    },\n    children: [showStepper && /*#__PURE__*/_jsx(FormProvider, _objectSpread(_objectSpread({}, methods), {}, {\n      children: /*#__PURE__*/_jsx(FormStepper, {\n        setShowStepper: setShowStepper,\n        onFinished: handleFinished\n      })\n    })), editPrestacion && /*#__PURE__*/_jsx(Modal, {\n      customClasses: {},\n      open: true,\n      onClose: () => setEditPrestacion(false),\n      title: SOLICITUDES.modalEditPrestacion.mainTitle,\n      breadcrumbs: '',\n      maxWidth: 'md',\n      children: /*#__PURE__*/_jsx(Form, {\n        config: configPrestaciones,\n        data: editPrestacion,\n        onSubmit: handleSubmitPrestacion,\n        onCancel: () => {\n          setEditPrestacion(null);\n        }\n      })\n    }), /*#__PURE__*/_jsx(SolicitudesList, {\n      data: data,\n      handleDelete: handleDelete,\n      onEdit: () => {},\n      onShowStepper: handleShowStepper,\n      onPaginationChange: handleChangePagination,\n      onFilter: () => {\n        setShowFilters(!showFilters);\n      },\n      onEditPrestacion: handleEditPrestacion\n    }), /*#__PURE__*/_jsx(TableFilters, {\n      config: filterConfig,\n      data: filters,\n      onSubmit: handleFilter,\n      onCancel: handleCancelFilter,\n      show: showFilters\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}