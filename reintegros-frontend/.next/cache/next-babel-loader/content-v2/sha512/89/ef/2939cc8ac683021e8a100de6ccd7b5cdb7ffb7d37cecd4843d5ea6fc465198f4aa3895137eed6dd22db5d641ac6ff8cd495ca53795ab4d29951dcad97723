{"ast":null,"code":"import _defineProperty from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Box } from '@material-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport { NOMENCLADOR, PRESTACIONES } from '../../../labels';\nimport AttachMoneyOutlinedIcon from '@material-ui/icons/AttachMoneyOutlined';\nimport Form, { FieldType } from '../../builder';\nimport { parseISO, subDays } from 'date-fns';\nimport { get } from '../../api-call/service';\nexport var FormEditPrestaciones = function FormEditPrestaciones(_ref) {\n  var prestacion = _ref.prestacion,\n      submit = _ref.submit,\n      onCancel = _ref.onCancel;\n\n  var _useState = useState(new Date()),\n      fechaDesde = _useState[0],\n      setFechaDesde = _useState[1];\n\n  var _useState2 = useState(prestacion.isDateRange === 'range'),\n      isDateRange = _useState2[0],\n      setIsDateRange = _useState2[1];\n\n  var _useState3 = useState(null),\n      fechaVigenciaHastaLiminit = _useState3[0],\n      setFechaVigenciaHastaLimit = _useState3[1];\n\n  var _useState4 = useState(false),\n      loaded = _useState4[0],\n      setLoaded = _useState4[1];\n\n  var _useState5 = useState({\n    prestaciones: []\n  }),\n      solicitud = _useState5[0],\n      setSolicitud = _useState5[1];\n\n  var _useState6 = useState({}),\n      nomenclador = _useState6[0],\n      setNomenclador = _useState6[1];\n\n  var prestadores = [];\n  var configPrestaciones = [{\n    name: 'capitulo',\n    type: FieldType.options,\n    label: PRESTACIONES.fields.capitulo,\n    options: function () {\n      var _options = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                return _context.abrupt(\"return\", [{\n                  value: prestacion.capitulo.value,\n                  label: prestacion.capitulo.label\n                }]);\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function options() {\n        return _options.apply(this, arguments);\n      }\n\n      return options;\n    }(),\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true\n    },\n    disabled: true\n  }, {\n    name: 'nomenclador',\n    type: FieldType.options,\n    label: PRESTACIONES.fields.nomenclador,\n    options: function () {\n      var _options2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(form, query) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                return _context2.abrupt(\"return\", [{\n                  value: prestacion.nomenclador.value,\n                  label: prestacion.nomenclador.label\n                }]);\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function options(_x, _x2) {\n        return _options2.apply(this, arguments);\n      }\n\n      return options;\n    }(),\n    styling: {\n      columns: 12\n    },\n    rules: {\n      required: true\n    },\n    disabled: true\n  }, {\n    name: 'isDateRange',\n    type: FieldType.options,\n    label: 'Fecha / Rango',\n    options: PRESTACIONES.optionsDate,\n    styling: {\n      columns: 6\n    },\n    onChange: function onChange(val, form) {\n      setIsDateRange(val === 'range');\n    }\n  }, {\n    name: 'fechaPractica',\n    type: FieldType.date,\n    label: PRESTACIONES.fields.fechaPractica,\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true,\n      min: subDays(new Date(), 60).toString(),\n      max: new Date().toString()\n    },\n    onChange: function onChange(val, form) {\n      setFechaDesde(val);\n    }\n  }, {\n    name: 'fechaPracticaHasta',\n    type: FieldType.date,\n    label: PRESTACIONES.fields.fechaPracticaHasta,\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true,\n      min: fechaDesde.toString(),\n      max: fechaVigenciaHastaLiminit\n    },\n    disabled: !isDateRange\n  }, {\n    name: 'modalidad',\n    type: FieldType.options,\n    label: PRESTACIONES.fields.modalidad,\n    options: NOMENCLADOR.optionsModalidadPresentacion,\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true\n    },\n    disabled: true\n  }, {\n    name: 'cobertura',\n    type: FieldType.string,\n    label: PRESTACIONES.fields.cobertura,\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true\n    },\n    disabled: true,\n    prefix: /*#__PURE__*/_jsx(_Fragment, {\n      children: \"%\"\n    })\n  }, {\n    name: 'estadoActual',\n    type: FieldType.options,\n    label: PRESTACIONES.fields['estadoActual'],\n    options: PRESTACIONES.optionsEstadoActual,\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true\n    },\n    disabled: true\n  }, {\n    name: 'prestador',\n    type: FieldType.options,\n    label: PRESTACIONES.fields.prestador,\n    options: function () {\n      var _options3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                return _context3.abrupt(\"return\", prestadores);\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      function options() {\n        return _options3.apply(this, arguments);\n      }\n\n      return options;\n    }(),\n    onUpdate: function () {\n      var _onUpdate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(val, form) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(val === '')) {\n                  _context4.next = 3;\n                  break;\n                }\n\n                prestadores = [];\n                return _context4.abrupt(\"return\");\n\n              case 3:\n                _context4.next = 5;\n                return get(\"api/prestadores/?profEstado=alta&matricula=\".concat(val));\n\n              case 5:\n                prestadores = _context4.sent.data.results.map(function (p) {\n                  return {\n                    value: p.id,\n                    label: \"\".concat(p.matricula, \" - \").concat(p.nombre, \" \").concat(p.apellido)\n                  };\n                });\n\n              case 6:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      function onUpdate(_x3, _x4) {\n        return _onUpdate.apply(this, arguments);\n      }\n\n      return onUpdate;\n    }(),\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true\n    },\n    help: 'Si no encuentra el prestador, solicite el alta al Administrador del sistema.'\n  }, {\n    name: 'br',\n    type: FieldType.br,\n    label: ''\n  }, {\n    name: 'valorIprossNomenclador',\n    type: FieldType.string,\n    label: PRESTACIONES.fields.valorIprossNomenclador,\n    styling: {\n      columns: 3\n    },\n    rules: {\n      required: true\n    },\n    disabled: true,\n    prefix: /*#__PURE__*/_jsx(AttachMoneyOutlinedIcon, {})\n  }, {\n    name: 'montoTotal',\n    type: FieldType.string,\n    label: PRESTACIONES.fields.montoTotal,\n    styling: {\n      columns: 3\n    },\n    rules: {\n      min: 1,\n      required: true\n    },\n    disabled: true\n  }, {\n    name: 'valorPrestacion',\n    type: FieldType[\"float\"],\n    label: PRESTACIONES.fields.valorPrestacion,\n    styling: {\n      columns: 3\n    },\n    rules: {\n      required: true\n    },\n    prefix: /*#__PURE__*/_jsx(AttachMoneyOutlinedIcon, {})\n  }, {\n    name: 'montoReintegrar',\n    type: FieldType.string,\n    label: PRESTACIONES.fields.montoReintegrar,\n    styling: {\n      columns: 3\n    },\n    rules: {\n      required: true\n    },\n    disabled: true,\n    prefix: /*#__PURE__*/_jsx(AttachMoneyOutlinedIcon, {})\n  }, {\n    name: 'cantidad',\n    type: FieldType[\"int\"],\n    label: PRESTACIONES.fields.cantidad,\n    styling: {\n      columns: 6\n    },\n    rules: {\n      min: 1,\n      required: true\n    },\n    onChange: function onChange(val, form) {\n      var valorIpross = form.getValues()['valorIprossNomenclador'];\n      var montoTotal = valorIpross * val;\n      form.setValue('montoTotal', montoTotal.toFixed(2));\n      var cobertura = form.getValues()['cobertura'];\n      var montoReintegrar = (valorIpross * val * (parseInt(cobertura) / 100)).toFixed(2);\n      form.setValue('montoReintegrar', montoReintegrar);\n    }\n  }, {\n    name: 'periodo',\n    type: FieldType.options,\n    options: NOMENCLADOR.optionsPeriodoTope,\n    label: PRESTACIONES.fields.periodo,\n    styling: {\n      columns: 6\n    },\n    rules: {\n      required: true\n    }\n  }];\n\n  var handleCancelPrestacion = function handleCancelPrestacion() {\n    onCancel();\n  };\n\n  var handleSubmitPrestacion = function handleSubmitPrestacion(data) {\n    submit(_objectSpread({\n      id: prestacion.id\n    }, data));\n  };\n\n  useEffect(function () {\n    console.log({\n      prestacion: prestacion\n    });\n\n    if (!loaded) {\n      get(\"api/solicitudes/\".concat(prestacion.solicitud.id)).then(function (response) {\n        setSolicitud(response.data);\n      });\n      get(\"api/nomenclador/\".concat(prestacion.nomenclador.value)).then(function (response) {\n        var _response$data, _response$data2;\n\n        setNomenclador(response === null || response === void 0 ? void 0 : response.data);\n        setFechaVigenciaHastaLimit(response !== null && response !== void 0 && (_response$data = response.data) !== null && _response$data !== void 0 && _response$data.fechaVigenciaHasta ? parseISO(response === null || response === void 0 ? void 0 : (_response$data2 = response.data) === null || _response$data2 === void 0 ? void 0 : _response$data2.fechaVigenciaHasta) : null);\n        console.log({\n          nomenclador: response.data\n        });\n      });\n      setLoaded(true);\n    }\n  }, [prestacion]);\n  return /*#__PURE__*/_jsx(Box, {\n    margin: 3,\n    children: /*#__PURE__*/_jsx(Form, {\n      config: configPrestaciones,\n      data: prestacion,\n      onSubmit: handleSubmitPrestacion,\n      onCancel: function onCancel() {\n        handleCancelPrestacion();\n      }\n    })\n  });\n};","map":null,"metadata":{},"sourceType":"module"}