{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/reintegros/reintegros-frontend/components/solicitudes/SolicitudesList.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState } from 'react';\nimport { Delete } from '@material-ui/icons';\nimport AddIcon from '@material-ui/icons/Add';\nimport ReceiptIcon from '@material-ui/icons/Receipt';\nimport { ACTIONS, SOLICITUDES, STEPPER_SOLICITUDES } from '../../labels';\nimport Table from '../common/Table';\nimport SolicitudesSummary from './SolicitudesSummary';\nimport { send } from '../api-call/service';\nimport Modal from '../common/Modal';\nimport { Box, Divider, IconButton, Link, List, ListItem, ListItemText, Typography } from '@material-ui/core';\nimport Loading from '../common/Loading';\nimport SubTitleModalCreateCupones from './SubTitleModalCreateCupones';\nimport Alert from '../common/Alert';\nimport { isUserAdmin, isUserDelegado, isUserReintegro } from '../common/helpers';\nexport default function SolicitudesList({\n  data,\n  handleDelete,\n  onEdit,\n  onShowStepper,\n  onPaginationChange,\n  onFilter,\n  onEditPrestacion,\n  onExport\n}) {\n  var _data, _data2;\n\n  const {\n    0: openModal,\n    1: setOpenModal\n  } = useState(false);\n  const {\n    0: dataPreview,\n    1: setDataPreview\n  } = useState([]);\n  const {\n    0: solicitudPreview,\n    1: setSolicitudPreview\n  } = useState(null);\n  const {\n    0: processing,\n    1: setProcessing\n  } = useState(false);\n  const {\n    0: info,\n    1: setInfo\n  } = useState(null);\n  const {\n    0: error,\n    1: setError\n  } = useState(null);\n  const {\n    0: pagination,\n    1: setPagination\n  } = useState({\n    page: 1,\n    pageSize: 20\n  });\n  const dynamicRenders = {\n    'factura.id': rowData => {\n      var _rowData$factura;\n\n      if ((_rowData$factura = rowData.factura) !== null && _rowData$factura !== void 0 && _rowData$factura.archivo) {\n        const filesUrl = process.env.NEXT_PUBLIC_API.substring(0, process.env.NEXT_PUBLIC_API.length - 1);\n        return /*#__PURE__*/_jsxDEV(Link, {\n          href: `${filesUrl}${rowData.factura.archivo}`,\n          target: \"_blank\",\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            color: \"primary\",\n            \"aria-label\": \"factura\",\n            component: \"span\",\n            children: /*#__PURE__*/_jsxDEV(ReceiptIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 69,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 68,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this);\n      }\n    }\n  };\n  const columns = Object.keys(SOLICITUDES.fields).map(key => {\n    var _ref, _dynamicRenders$key;\n\n    return {\n      title: SOLICITUDES.fields[key],\n      field: key,\n      render: (_ref = (_dynamicRenders$key = dynamicRenders[key]) !== null && _dynamicRenders$key !== void 0 ? _dynamicRenders$key : SOLICITUDES.renders[key]) !== null && _ref !== void 0 ? _ref : null\n    };\n  });\n\n  const getHeaderActions = () => {\n    var options = [];\n\n    if (isUserAdmin() || isUserDelegado() || isUserReintegro()) {\n      options = [{\n        label: STEPPER_SOLICITUDES.add,\n        onClick: onShowStepper,\n        icon: /*#__PURE__*/_jsxDEV(AddIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 17\n        }, this)\n      }];\n    }\n\n    return options;\n  };\n\n  const getActions = () => {\n    var actions = []; // if (isUserAdmin() || isUserReintegro() || isUserDelegado()) {\n    //   actions.push({\n    //     icon: () => <Edit />,\n    //     tooltip: ACTIONS.update(SOLICITUDES.name),\n    //     onClick: (event, rowData) => {\n    //       onEdit(rowData);\n    //     },\n    //   });\n    // }\n\n    if (isUserAdmin()) {\n      actions = [...actions, {\n        icon: () => /*#__PURE__*/_jsxDEV(Delete, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 23\n        }, this),\n        tooltip: ACTIONS.delete(SOLICITUDES.name),\n        onClick: async (event, selected) => {\n          selected.forEach(s => {\n            handleDelete(s === null || s === void 0 ? void 0 : s.id);\n          });\n        }\n      }, {\n        icon: () => /*#__PURE__*/_jsxDEV(AddIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 121,\n          columnNumber: 23\n        }, this),\n        tooltip: 'Crear solicitudes de autorizaciÃ³n',\n        onClick: async (event, rowData) => {\n          preCreateCupones(rowData);\n        }\n      }];\n    }\n\n    return actions;\n  };\n\n  const preCreateCupones = async rowData => {\n    setInfo(null);\n    setError(null);\n    data = rowData.map(item => item.id);\n\n    try {\n      const preview = await send({\n        url: `api/cupon/verificar`,\n        data: {\n          solicitudes: data\n        },\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      setOpenModal(true);\n      setSolicitudPreview(rowData);\n      setDataPreview(preview.data.results);\n    } catch (error) {\n      setError('Error');\n    }\n  };\n\n  const handleConfirmModal = async () => {\n    setInfo(null);\n    setError(null);\n    var ids = [];\n    dataPreview.forEach(value => {\n      ids.push(value.solicitud.id);\n    });\n    setProcessing(true);\n\n    try {\n      const preview = await send({\n        url: `api/cupon/`,\n        data: {\n          solicitudes: ids\n        },\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (preview.data.count === 0) {\n        setError(SOLICITUDES.messages.errorCreateCupones);\n      } else {\n        setInfo(SOLICITUDES.messages.successCreateCupones(preview.data.count));\n      }\n\n      setOpenModal(false);\n    } catch (error) {\n      setError('Error');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleCancelModal = () => {\n    setOpenModal(false);\n  };\n\n  const reloadPagination = pagData => {\n    setPagination(pagData);\n    onPaginationChange(_objectSpread(_objectSpread({}, pagination), pagData));\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Table, {\n      columns: columns,\n      totalCount: (_data = data) === null || _data === void 0 ? void 0 : _data.count,\n      data: (_data2 = data) === null || _data2 === void 0 ? void 0 : _data2.results,\n      title: SOLICITUDES.name,\n      headerActions: getHeaderActions(),\n      options: {\n        search: true,\n        selection: !!isUserAdmin(),\n        exportFileName: 'Solicitudes',\n        exportButton: {\n          csv: true,\n          pdf: false\n        },\n        exportAllData: true,\n        exportCsv: onExport\n      },\n      pagination: {\n        page: pagination.page - 1,\n        pageSize: pagination.pageSize\n      },\n      onPageChange: (page, pageSize) => {\n        reloadPagination(_objectSpread(_objectSpread({}, pagination), {}, {\n          page: page + 1,\n          pageSize\n        }));\n      },\n      onChangeRowsPerPage: pageSize => {\n        reloadPagination(_objectSpread(_objectSpread({}, pagination), {}, {\n          pageSize\n        }));\n      },\n      actions: getActions(),\n      onFilterClick: onFilter,\n      detailPanel: rowData => /*#__PURE__*/_jsxDEV(SolicitudesSummary, {\n        solicitud: rowData,\n        header: false,\n        prestaciones: rowData.prestaciones,\n        onEditPrestacion: onEditPrestacion\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 11\n      }, this),\n      onSelectionChange: () => {}\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 7\n    }, this), openModal && dataPreview && /*#__PURE__*/_jsxDEV(Modal, {\n      customClasses: {},\n      open: true,\n      onClose: () => setOpenModal(!openModal),\n      title: SOLICITUDES.modalCreateCupones.mainTitle,\n      breadcrumbs: '',\n      subTitle: /*#__PURE__*/_jsxDEV(SubTitleModalCreateCupones, {\n        data: dataPreview,\n        solicitudes: solicitudPreview\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 13\n      }, this),\n      actions: true,\n      onAcept: handleConfirmModal,\n      onCancel: handleCancelModal,\n      maxWidth: 'md',\n      children: [/*#__PURE__*/_jsxDEV(List, {\n        children: dataPreview.map((item, index) => {\n          if (!item.isValid) {\n            return /*#__PURE__*/_jsxDEV(Box, {\n              children: [/*#__PURE__*/_jsxDEV(ListItem, {\n                children: /*#__PURE__*/_jsxDEV(Box, {\n                  children: [/*#__PURE__*/_jsxDEV(Box, {\n                    fontWeight: \"fontWeightBold\",\n                    children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                      primary: /*#__PURE__*/_jsxDEV(Box, {\n                        fontWeight: \"fontWeightBold\",\n                        children: `Solicitud: ${item.solicitud.id}`\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 260,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 258,\n                      columnNumber: 27\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 257,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Box, {\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    ml: 5,\n                    children: [/*#__PURE__*/_jsxDEV(Box, {\n                      children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                        primary: \"No es v\\xE1lida\",\n                        secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                          color: \"error\",\n                          children: \"Errores:\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 268,\n                          columnNumber: 42\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 266,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 265,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(Box, {\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      children: item.errors.map((item, ii) => {\n                        return /*#__PURE__*/_jsxDEV(ListItemText, {\n                          children: `- ${item}`\n                        }, ii, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 273,\n                          columnNumber: 38\n                        }, this);\n                      })\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 271,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 264,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 256,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 255,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Divider, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 279,\n                columnNumber: 21\n              }, this)]\n            }, index, true, {\n              fileName: _jsxFileName,\n              lineNumber: 254,\n              columnNumber: 19\n            }, this);\n          }\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Loading, {\n        loading: dataPreview.length == 0 || processing,\n        message: SOLICITUDES.messages.loading\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Alert, {\n      open: info !== null && info !== void 0 ? info : error,\n      severity: error ? 'error' : 'success',\n      message: info || error,\n      autoHideAfter: 5500,\n      onClose: () => {\n        setInfo(null);\n        setError(null);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}","map":{"version":3,"sources":["/reintegros/reintegros-frontend/components/solicitudes/SolicitudesList.tsx"],"names":["React","useState","Delete","AddIcon","ReceiptIcon","ACTIONS","SOLICITUDES","STEPPER_SOLICITUDES","Table","SolicitudesSummary","send","Modal","Box","Divider","IconButton","Link","List","ListItem","ListItemText","Typography","Loading","SubTitleModalCreateCupones","Alert","isUserAdmin","isUserDelegado","isUserReintegro","SolicitudesList","data","handleDelete","onEdit","onShowStepper","onPaginationChange","onFilter","onEditPrestacion","onExport","openModal","setOpenModal","dataPreview","setDataPreview","solicitudPreview","setSolicitudPreview","processing","setProcessing","info","setInfo","error","setError","pagination","setPagination","page","pageSize","dynamicRenders","rowData","factura","archivo","filesUrl","process","env","NEXT_PUBLIC_API","substring","length","columns","Object","keys","fields","map","key","title","field","render","renders","getHeaderActions","options","label","add","onClick","icon","getActions","actions","tooltip","delete","name","event","selected","forEach","s","id","preCreateCupones","item","preview","url","solicitudes","method","headers","results","handleConfirmModal","ids","value","push","solicitud","count","messages","errorCreateCupones","successCreateCupones","handleCancelModal","reloadPagination","pagData","search","selection","exportFileName","exportButton","csv","pdf","exportAllData","exportCsv","prestaciones","modalCreateCupones","mainTitle","index","isValid","errors","ii","loading"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Delete, Edit, PinDropSharp } from '@material-ui/icons';\nimport AddIcon from '@material-ui/icons/Add';\nimport ReceiptIcon from '@material-ui/icons/Receipt';\nimport { ACTIONS, SOLICITUDES, STEPPER_SOLICITUDES } from '../../labels';\nimport Table from '../common/Table';\nimport { apiRequest } from '../common/types/Request';\nimport SolicitudesSummary from './SolicitudesSummary';\nimport { Solicitud } from '../common/types/Solicitud';\nimport { send } from '../api-call/service';\nimport Modal from '../common/Modal';\nimport {\n  Box,\n  Divider,\n  IconButton,\n  Link,\n  List,\n  ListItem,\n  ListItemText,\n  Typography,\n} from '@material-ui/core';\nimport Loading from '../common/Loading';\nimport SubTitleModalCreateCupones from './SubTitleModalCreateCupones';\nimport Alert from '../common/Alert';\nimport { isUserAdmin, isUserDelegado, isUserReintegro } from '../common/helpers';\nimport filterConfig from './FiltersConfig';\n\ntype Props = {\n  data: apiRequest;\n  handleDelete?: (id: number) => void;\n  onEdit: (data: Solicitud) => void;\n  onShowStepper: () => void;\n  onPaginationChange: (pagination: any) => void;\n  onFilter: () => void;\n  onEditPrestacion?: (data: any) => void;\n  onExport?: (allColumns: any, allData: any) => void;\n};\nexport default function SolicitudesList({\n  data,\n  handleDelete,\n  onEdit,\n  onShowStepper,\n  onPaginationChange,\n  onFilter,\n  onEditPrestacion,\n  onExport,\n}: Props) {\n  const [openModal, setOpenModal] = useState(false);\n  const [dataPreview, setDataPreview] = useState([]);\n  const [solicitudPreview, setSolicitudPreview] = useState(null);\n  const [processing, setProcessing] = useState(false);\n  const [info, setInfo] = useState(null);\n  const [error, setError] = useState(null);\n  const [pagination, setPagination] = useState({\n    page: 1,\n    pageSize: 20,\n  });\n\n  const dynamicRenders = {\n    'factura.id': (rowData) => {\n      if (rowData.factura?.archivo) {\n        const filesUrl = process.env.NEXT_PUBLIC_API.substring(\n          0,\n          process.env.NEXT_PUBLIC_API.length - 1,\n        );\n        return (\n          <Link href={`${filesUrl}${rowData.factura.archivo}`} target=\"_blank\">\n            <IconButton color=\"primary\" aria-label=\"factura\" component=\"span\">\n              <ReceiptIcon />\n            </IconButton>\n          </Link>\n        );\n      }\n    },\n  };\n\n  const columns = Object.keys(SOLICITUDES.fields).map((key) => ({\n    title: SOLICITUDES.fields[key],\n    field: key,\n    render: dynamicRenders[key] ?? SOLICITUDES.renders[key] ?? null,\n  }));\n\n  const getHeaderActions = () => {\n    var options = [];\n    if (isUserAdmin() || isUserDelegado() || isUserReintegro()) {\n      options = [\n        {\n          label: STEPPER_SOLICITUDES.add,\n          onClick: onShowStepper,\n          icon: <AddIcon />,\n        },\n      ];\n    }\n    return options;\n  };\n\n  const getActions = () => {\n    var actions = [];\n    // if (isUserAdmin() || isUserReintegro() || isUserDelegado()) {\n    //   actions.push({\n    //     icon: () => <Edit />,\n    //     tooltip: ACTIONS.update(SOLICITUDES.name),\n    //     onClick: (event, rowData) => {\n    //       onEdit(rowData);\n    //     },\n    //   });\n    // }\n    if (isUserAdmin()) {\n      actions = [\n        ...actions,\n        {\n          icon: () => <Delete />,\n          tooltip: ACTIONS.delete(SOLICITUDES.name),\n          onClick: async (event, selected) => {\n            selected.forEach((s) => {\n              handleDelete(s?.id);\n            });\n          },\n        },\n        {\n          icon: () => <AddIcon />,\n          tooltip: 'Crear solicitudes de autorizaciÃ³n',\n          onClick: async (event, rowData) => {\n            preCreateCupones(rowData);\n          },\n        },\n      ];\n    }\n    return actions;\n  };\n\n  const preCreateCupones = async (rowData) => {\n    setInfo(null);\n    setError(null);\n    data = rowData.map((item) => item.id);\n    try {\n      const preview = await send({\n        url: `api/cupon/verificar`,\n        data: { solicitudes: data },\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n      setOpenModal(true);\n      setSolicitudPreview(rowData);\n      setDataPreview(preview.data.results);\n    } catch (error) {\n      setError('Error');\n    }\n  };\n\n  const handleConfirmModal = async () => {\n    setInfo(null);\n    setError(null);\n    var ids = [];\n    dataPreview.forEach((value) => {\n      ids.push(value.solicitud.id);\n    });\n    setProcessing(true);\n    try {\n      const preview = await send({\n        url: `api/cupon/`,\n        data: { solicitudes: ids },\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n      if (preview.data.count === 0) {\n        setError(SOLICITUDES.messages.errorCreateCupones);\n      } else {\n        setInfo(SOLICITUDES.messages.successCreateCupones(preview.data.count));\n      }\n\n      setOpenModal(false);\n    } catch (error) {\n      setError('Error');\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const handleCancelModal = () => {\n    setOpenModal(false);\n  };\n\n  const reloadPagination = (pagData: any) => {\n    setPagination(pagData);\n    onPaginationChange({ ...pagination, ...pagData });\n  };\n\n  return (\n    <>\n      <Table\n        columns={columns}\n        totalCount={data?.count}\n        data={data?.results}\n        title={SOLICITUDES.name}\n        headerActions={getHeaderActions()}\n        options={{\n          search: true,\n          selection: !!isUserAdmin(),\n          exportFileName: 'Solicitudes',\n          exportButton: {\n            csv: true,\n            pdf: false,\n          },\n          exportAllData: true,\n          exportCsv: onExport,\n        }}\n        pagination={{\n          page: pagination.page - 1,\n          pageSize: pagination.pageSize,\n        }}\n        onPageChange={(page: number, pageSize: number) => {\n          reloadPagination({ ...pagination, page: page + 1, pageSize });\n        }}\n        onChangeRowsPerPage={(pageSize) => {\n          reloadPagination({ ...pagination, pageSize });\n        }}\n        actions={getActions()}\n        onFilterClick={onFilter}\n        detailPanel={(rowData) => (\n          <SolicitudesSummary\n            solicitud={rowData}\n            header={false}\n            prestaciones={rowData.prestaciones}\n            onEditPrestacion={onEditPrestacion}\n          />\n        )}\n        onSelectionChange={() => {}}\n      />\n\n      {openModal && dataPreview && (\n        <Modal\n          customClasses={{}}\n          open={true}\n          onClose={() => setOpenModal(!openModal)}\n          title={SOLICITUDES.modalCreateCupones.mainTitle}\n          breadcrumbs={''}\n          subTitle={\n            <SubTitleModalCreateCupones data={dataPreview} solicitudes={solicitudPreview} />\n          }\n          actions={true}\n          onAcept={handleConfirmModal}\n          onCancel={handleCancelModal}\n          maxWidth={'md'}\n        >\n          <List>\n            {dataPreview.map((item, index) => {\n              if (!item.isValid) {\n                return (\n                  <Box key={index}>\n                    <ListItem>\n                      <Box>\n                        <Box fontWeight=\"fontWeightBold\">\n                          <ListItemText\n                            primary={\n                              <Box fontWeight=\"fontWeightBold\">{`Solicitud: ${item.solicitud.id}`}</Box>\n                            }\n                          />\n                        </Box>\n                        <Box display=\"flex\" flexDirection=\"column\" ml={5}>\n                          <Box>\n                            <ListItemText\n                              primary=\"No es vÃ¡lida\"\n                              secondary={<Typography color=\"error\">Errores:</Typography>}\n                            />\n                          </Box>\n                          <Box display=\"flex\" flexDirection=\"column\">\n                            {item.errors.map((item, ii) => {\n                              return <ListItemText key={ii}>{`- ${item}`}</ListItemText>;\n                            })}\n                          </Box>\n                        </Box>\n                      </Box>\n                    </ListItem>\n                    <Divider />\n                  </Box>\n                );\n              }\n            })}\n          </List>\n          <Loading\n            loading={dataPreview.length == 0 || processing}\n            message={SOLICITUDES.messages.loading}\n          />\n        </Modal>\n      )}\n      <Alert\n        open={info ?? error}\n        severity={error ? 'error' : 'success'}\n        message={info || error}\n        autoHideAfter={5500}\n        onClose={() => {\n          setInfo(null);\n          setError(null);\n        }}\n      />\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}