{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _defineProperty from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState } from 'react';\nimport { LOTES } from '../../labels';\nimport Table from '../common/Table';\nimport CloudDownloadIcon from '@material-ui/icons/CloudDownload';\nimport { send } from '../api-call/service';\nimport AddIcon from '@material-ui/icons/Add';\nimport AssessmentIcon from '@material-ui/icons/Assessment';\nimport ShowChartIcon from '@material-ui/icons/ShowChart';\nimport AccountBalanceIcon from '@material-ui/icons/AccountBalance';\nimport ProcesarQnYQoForm from './ProcesarQnYQoForm';\nimport Modal from '../common/Modal';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { Box, Button, List, ListItem, ListItemText, Typography } from '@material-ui/core';\nimport SubtitleModalResultQnQofiles from './SubtitleModalResultQnQofiles';\nimport { isUserAdmin, isUserContaduria, isUserTesoreria } from '../common/helpers';\nimport { Delete } from '@material-ui/icons';\nimport filterConfig from './FiltersConfig';\nimport ChangeLoteJudicialState from './ChangeLoteJudicialState';\nexport default function LotesList(_ref) {\n  var data = _ref.data,\n      handleDelete = _ref.handleDelete,\n      onReload = _ref.onReload,\n      onPaginationChange = _ref.onPaginationChange,\n      onFilter = _ref.onFilter,\n      onExport = _ref.onExport,\n      onHandleSetState = _ref.onHandleSetState;\n\n  var _useState = useState(false),\n      loading = _useState[0],\n      setLoading = _useState[1];\n\n  var _useState2 = useState(false),\n      openModal = _useState2[0],\n      setOpenModal = _useState2[1];\n\n  var _useState3 = useState(false),\n      openModalResult = _useState3[0],\n      setOpenModalResult = _useState3[1];\n\n  var _useState4 = useState(null),\n      idLoteSelected = _useState4[0],\n      setIdLoteSelected = _useState4[1];\n\n  var _useState5 = useState(false),\n      processingQnQofile = _useState5[0],\n      setProcessingQnQofile = _useState5[1];\n\n  var _useState6 = useState({}),\n      dataResultOfQnQoFile = _useState6[0],\n      setDataResultOfQnQoFile = _useState6[1];\n\n  var _useState7 = useState(false),\n      openForm = _useState7[0],\n      setOpenForm = _useState7[1];\n\n  var dynamicRenders = {\n    estado: function estado(rowData) {\n      if (rowData.tipo === 'judicial' && rowData.estado === 'noProcesado' && (isUserAdmin() || isUserContaduria() || isUserTesoreria())) {\n        return /*#__PURE__*/_jsx(ChangeLoteJudicialState, {\n          onSetState: onSetState,\n          rowData: rowData\n        });\n      } else {\n        var _LOTES$optionsEstados;\n\n        return /*#__PURE__*/_jsx(Typography, {\n          children: (_LOTES$optionsEstados = LOTES.optionsEstados.find(function (opt) {\n            return opt.value === rowData.estado;\n          })) === null || _LOTES$optionsEstados === void 0 ? void 0 : _LOTES$optionsEstados.label\n        });\n      }\n    }\n  };\n  var columns = Object.keys(LOTES.fields).map(function (key) {\n    var _ref2, _dynamicRenders$key;\n\n    return {\n      title: LOTES.fields[key],\n      field: key,\n      render: (_ref2 = (_dynamicRenders$key = dynamicRenders[key]) !== null && _dynamicRenders$key !== void 0 ? _dynamicRenders$key : LOTES.renders[key]) !== null && _ref2 !== void 0 ? _ref2 : null\n    };\n  });\n\n  var _useState8 = useState({\n    page: 1,\n    pageSize: 20\n  }),\n      pagination = _useState8[0],\n      setPagination = _useState8[1];\n\n  var onSetState = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(stateSelected, lote) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              onHandleSetState(stateSelected, lote);\n\n            case 1:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onSetState(_x, _x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var crearArchivoPo = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(rowData) {\n      var archivoPo;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setLoading(true);\n              _context2.next = 3;\n              return send({\n                url: \"api/lote/\".concat(rowData.id, \"/crear-archivo-po\"),\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 3:\n              archivoPo = _context2.sent;\n              setLoading(false);\n              onReload && onReload();\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function crearArchivoPo(_x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var descargarArchivoPo = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(rowData) {\n      var archivo_po, path_file, file_name, element, file;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return send({\n                url: \"api/archivo-po/\".concat(rowData.archivos_po[0].id, \"/descargar-archivo\"),\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'text/plain'\n                }\n              });\n\n            case 2:\n              archivo_po = _context3.sent;\n              path_file = rowData.archivos_po[0].archivo.split('/');\n              file_name = path_file[path_file.length - 1];\n              element = document.createElement('a');\n              file = new Blob([archivo_po.data], {\n                type: 'text/plain'\n              });\n              element.href = URL.createObjectURL(file);\n              element.download = file_name;\n              document.body.appendChild(element);\n              element.click();\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function descargarArchivoPo(_x4) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var descargarArchivoDetalleEnvioBanco = /*#__PURE__*/function () {\n    var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(rowData) {\n      var archivoInforme, fileName, element, file;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return send({\n                url: \"api/lote/\".concat(rowData.id, \"/descargar-archivo-detalle-envio-banco\"),\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'text/plain'\n                }\n              });\n\n            case 2:\n              archivoInforme = _context4.sent;\n              fileName = rowData.detalleEnvioBanco.split('/').pop();\n              element = document.createElement('a');\n              file = new Blob([archivoInforme.data], {\n                type: 'text/csv'\n              });\n              element.href = URL.createObjectURL(file);\n              element.download = fileName;\n              document.body.appendChild(element);\n              element.click();\n\n            case 10:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function descargarArchivoDetalleEnvioBanco(_x5) {\n      return _ref6.apply(this, arguments);\n    };\n  }();\n\n  var descargarArchivoTotalEnvioBanco = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(rowData) {\n      var archivoInforme, fileName, element, file;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return send({\n                url: \"api/lote/\".concat(rowData.id, \"/descargar-archivo-total-envio-banco\"),\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'text/plain'\n                }\n              });\n\n            case 2:\n              archivoInforme = _context5.sent;\n              fileName = rowData.totalEnvioBanco.split('/').pop();\n              element = document.createElement('a');\n              file = new Blob([archivoInforme.data], {\n                type: 'text/csv'\n              });\n              element.href = URL.createObjectURL(file);\n              element.download = fileName;\n              document.body.appendChild(element);\n              element.click();\n\n            case 10:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function descargarArchivoTotalEnvioBanco(_x6) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  var openFormFiles = function openFormFiles(rowData) {\n    setIdLoteSelected(rowData.id);\n    setOpenForm(true);\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(data) {\n      var _data$archivoQn, _data$archivoQo;\n\n      var formData, response;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              formData = new FormData();\n\n              if ((data === null || data === void 0 ? void 0 : (_data$archivoQn = data.archivoQn) === null || _data$archivoQn === void 0 ? void 0 : _data$archivoQn.length) > 0) {\n                formData.append('archivos', data.archivoQn[0]);\n              }\n\n              if ((data === null || data === void 0 ? void 0 : (_data$archivoQo = data.archivoQo) === null || _data$archivoQo === void 0 ? void 0 : _data$archivoQo.length) > 0) {\n                formData.append('archivos', data.archivoQo[0]);\n              }\n\n              setOpenForm(false);\n              setOpenModal(true);\n              setProcessingQnQofile(true);\n              _context6.next = 8;\n              return send({\n                url: \"api/lote/\".concat(idLoteSelected, \"/procesar-vuelta-del-banco\"),\n                data: formData,\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n\n            case 8:\n              response = _context6.sent;\n              setDataResultOfQnQoFile({\n                error: response.data.error,\n                detalle: response.data.detalle\n              });\n              setProcessingQnQofile(false);\n              setOpenModal(false);\n              setOpenModalResult(true);\n\n            case 13:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function handleSubmit(_x7) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n\n  var handleCancel = function handleCancel() {\n    setOpenForm(false);\n  };\n\n  var reloadPagination = function reloadPagination(pagData) {\n    setPagination(pagData);\n    onPaginationChange(_objectSpread(_objectSpread({}, pagination), pagData));\n  };\n\n  var deleteLote = /*#__PURE__*/function () {\n    var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(rowData) {\n      return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              handleDelete(rowData.id);\n\n            case 1:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7);\n    }));\n\n    return function deleteLote(_x8) {\n      return _ref9.apply(this, arguments);\n    };\n  }(); // Actions in table\n\n\n  var actionsUserTable = [function (rowData) {\n    return {\n      icon: function icon() {\n        return /*#__PURE__*/_jsx(AddIcon, {});\n      },\n      tooltip: 'Crear archivo PO',\n      onClick: function onClick(event, rowData) {\n        return crearArchivoPo(rowData);\n      },\n      disabled: rowData.archivos_po.length > 0 || loading ? true : false,\n      hidden: rowData.tipo === 'judicial' || rowData.estado === 'eliminado'\n    };\n  }, function (rowData) {\n    return {\n      icon: function icon() {\n        return /*#__PURE__*/_jsx(CloudDownloadIcon, {});\n      },\n      tooltip: 'Descargar archivo PO',\n      onClick: function onClick(event, rowData) {\n        return descargarArchivoPo(rowData);\n      },\n      disabled: rowData.archivos_po.length == 0 ? true : false,\n      hidden: rowData.tipo === 'judicial'\n    };\n  }, function (rowData) {\n    return {\n      icon: function icon() {\n        return /*#__PURE__*/_jsx(AssessmentIcon, {});\n      },\n      tooltip: 'Descargar informe detalle envio banco',\n      onClick: function onClick(event, rowData) {\n        return descargarArchivoDetalleEnvioBanco(rowData);\n      },\n      disabled: false\n    };\n  }, function (rowData) {\n    return {\n      icon: function icon() {\n        return /*#__PURE__*/_jsx(ShowChartIcon, {});\n      },\n      tooltip: 'Descargar informe total envio banco',\n      onClick: function onClick(event, rowData) {\n        return descargarArchivoTotalEnvioBanco(rowData);\n      },\n      disabled: false\n    };\n  }, function (rowData) {\n    return {\n      icon: function icon() {\n        return /*#__PURE__*/_jsx(AccountBalanceIcon, {});\n      },\n      tooltip: 'Procesar archivo QN y QO',\n      onClick: function onClick(event, rowData) {\n        return openFormFiles(rowData);\n      },\n      disabled: rowData.archivos_po.length == 0 || rowData.estado === 'procesadoOk' || rowData.estado === 'eliminado',\n      hidden: rowData.tipo === 'judicial'\n    };\n  }];\n\n  if (isUserAdmin()) {\n    actionsUserTable.push(function (rowData) {\n      return {\n        icon: function icon() {\n          return /*#__PURE__*/_jsx(Delete, {});\n        },\n        tooltip: 'Eliminar Lote',\n        onClick: function onClick(event, rowData) {\n          return deleteLote(rowData);\n        },\n        disabled: rowData.archivos_po.length > 0,\n        hidden: rowData.estado === 'eliminado'\n      };\n    });\n  }\n\n  var getAcions = function getAcions() {\n    var actions = [];\n\n    if (isUserAdmin()) {\n      actions = actionsUserTable;\n      return actions;\n    }\n\n    if (isUserContaduria() && isUserTesoreria()) {\n      actions = actionsUserTable;\n      return actions;\n    }\n\n    if (isUserContaduria()) {\n      actions = [actionsUserTable[0]];\n      return actions;\n    }\n\n    if (isUserTesoreria()) {\n      actions = [actionsUserTable[1], actionsUserTable[2], actionsUserTable[3], actionsUserTable[4]];\n      return actions;\n    }\n\n    return actions;\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [openForm && /*#__PURE__*/_jsx(ProcesarQnYQoForm, {\n      data: {},\n      handleSubmit: handleSubmit,\n      handleCancel: handleCancel\n    }), /*#__PURE__*/_jsx(Table, {\n      columns: columns,\n      totalCount: data === null || data === void 0 ? void 0 : data.count,\n      data: data === null || data === void 0 ? void 0 : data.results,\n      title: LOTES.name,\n      options: {\n        search: false,\n        exportFileName: 'Lotes',\n        exportButton: {\n          csv: true,\n          pdf: false\n        },\n        exportAllData: true,\n        exportCsv: onExport\n      },\n      pagination: {\n        page: pagination.page - 1,\n        pageSize: pagination.pageSize\n      },\n      onPageChange: function onPageChange(page, pageSize) {\n        reloadPagination(_objectSpread(_objectSpread({}, pagination), {}, {\n          page: page + 1,\n          pageSize: pageSize\n        }));\n      },\n      onChangeRowsPerPage: function onChangeRowsPerPage(pageSize) {\n        reloadPagination(_objectSpread(_objectSpread({}, pagination), {}, {\n          pageSize: pageSize\n        }));\n      },\n      tableFiltersConfig: filterConfig,\n      onFilterClick: onFilter,\n      actions: getAcions()\n    }), openModal && /*#__PURE__*/_jsx(Modal, {\n      customClasses: {},\n      open: true,\n      onClose: function onClose() {\n        return setOpenModal(!openModal);\n      },\n      title: 'Procesar Archivos QN y QO',\n      breadcrumbs: '',\n      subTitle: false,\n      actions: false,\n      onAcept: null,\n      onCancel: null,\n      maxWidth: 'md',\n      children: processingQnQofile && /*#__PURE__*/_jsx(Box, {\n        display: \"flex\",\n        justifyContent: \"center\",\n        children: /*#__PURE__*/_jsxs(Box, {\n          display: \"flex\",\n          flexDirection: \"column\",\n          alignItems: \"center\",\n          children: [/*#__PURE__*/_jsx(Typography, {\n            children: \"Procesando...\"\n          }), /*#__PURE__*/_jsx(CircularProgress, {})]\n        })\n      })\n    }), openModalResult && /*#__PURE__*/_jsxs(Modal, {\n      customClasses: {},\n      open: true,\n      onClose: function onClose() {\n        return setOpenModalResult(!openModalResult);\n      },\n      title: 'Resultado de procesar los archivos QN y QO',\n      breadcrumbs: '',\n      subTitle: /*#__PURE__*/_jsx(SubtitleModalResultQnQofiles, {\n        data: dataResultOfQnQoFile\n      }),\n      actions: false,\n      onAcept: null,\n      onCancel: null,\n      maxWidth: 'md',\n      children: [dataResultOfQnQoFile.error && /*#__PURE__*/_jsx(List, {\n        children: dataResultOfQnQoFile.detalle.map(function (item, i) {\n          return /*#__PURE__*/_jsx(ListItem, {\n            children: /*#__PURE__*/_jsx(ListItemText, {\n              primary: \"- \".concat(item)\n            })\n          });\n        })\n      }), /*#__PURE__*/_jsx(Box, {\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n        children: /*#__PURE__*/_jsx(Button, {\n          onClick: function onClick() {\n            setOpenModalResult(false);\n          },\n          color: \"primary\",\n          children: \"Salir\"\n        })\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}