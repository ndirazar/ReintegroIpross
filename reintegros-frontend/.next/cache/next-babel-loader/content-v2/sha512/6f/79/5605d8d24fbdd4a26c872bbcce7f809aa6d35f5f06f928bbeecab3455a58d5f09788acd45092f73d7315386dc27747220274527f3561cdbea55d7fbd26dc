{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/reintegros/reintegros-frontend/components/solicitudes/Stepper.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport _ from 'lodash';\nimport Typography from '@material-ui/core/Typography';\nimport { format } from 'date-fns';\nimport { get, post } from '../api-call/service';\nimport { SOLICITUDES, STEPPER_SOLICITUDES } from '../../labels';\nimport useStyles from './Stepper.styles';\nimport { Box } from '@material-ui/core';\nimport { FormSolicitud } from './FormSolicitud';\nimport { FormPrestaciones } from './prestaciones/FormPrestaciones';\nimport { FormAdjuntos } from './adjuntos/FormAdjuntos';\nimport SolicitudesSummary from './SolicitudesSummary';\nexport const FormStepper = ({\n  setShowStepper\n}) => {\n  const {\n    watch,\n    errors,\n    trigger\n  } = useFormContext();\n  const [activeStep, setActiveStep] = React.useState(0);\n  const [compiledForm, setCompiledForm] = React.useState({});\n  const steps = STEPPER_SOLICITUDES.steps.map(elem => elem.title);\n  const form = watch();\n  const [prestaciones, setPrestaciones] = React.useState([]);\n  const [solicitud, setSolicitud] = React.useState(null);\n  const classes = useStyles();\n\n  const addPrestacion = async factura => {\n    form.fechaPractica = format(form === null || form === void 0 ? void 0 : form.fechaPractica, 'yyyy-MM-dd');\n    form.cobertura = parseInt(form.cobertura);\n    form.coseguroNomenclador = parseFloat(form.coseguroNomenclador).toFixed(2);\n    const nomenclador = await get(`/nomenclador/${form === null || form === void 0 ? void 0 : form.nomenclador}`);\n    setPrestaciones([...prestaciones, _objectSpread(_objectSpread({}, form), {}, {\n      factura,\n      item: nomenclador === null || nomenclador === void 0 ? void 0 : nomenclador.data\n    })]);\n  };\n\n  const removePrestacion = id => {\n    setPrestaciones([...prestaciones.filter((_, index) => index !== id)]);\n  };\n\n  function getStepContent(step, formContent) {\n    switch (step) {\n      case 0:\n        return /*#__PURE__*/_jsxDEV(FormSolicitud, _objectSpread(_objectSpread({}, {\n          formContent\n        }), {}, {\n          step: STEPPER_SOLICITUDES.steps[step]\n        }), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 16\n        }, this);\n\n      case 1:\n        return /*#__PURE__*/_jsxDEV(FormPrestaciones, _objectSpread(_objectSpread({}, {\n          formContent\n        }), {}, {\n          step: STEPPER_SOLICITUDES.steps[step],\n          addPrestacion: addPrestacion,\n          prestaciones: prestaciones,\n          removePrestacion: removePrestacion\n        }), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 48,\n          columnNumber: 11\n        }, this);\n\n      case 2:\n        return /*#__PURE__*/_jsxDEV(SolicitudesSummary, {\n          solicitud: solicitud,\n          prestaciones: prestaciones,\n          header: true,\n          step: STEPPER_SOLICITUDES.steps[step]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 11\n        }, this);\n\n      case 3:\n        return /*#__PURE__*/_jsxDEV(FormAdjuntos, {\n          prestaciones: prestaciones,\n          step: STEPPER_SOLICITUDES.steps[step]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 16\n        }, this);\n\n      default:\n        return 'Unknown step';\n    }\n  }\n\n  const handleNext = async () => {\n    let canContinue = true;\n    const result = await trigger();\n\n    if (!result) {\n      return;\n    }\n\n    switch (activeStep) {\n      case 0:\n        setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n          solicitud: form\n        }));\n        setSolicitud(_objectSpread({}, form));\n        canContinue = true;\n        break;\n\n      case 1:\n        setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n          prestaciones: prestaciones\n        }));\n        canContinue = true;\n        break;\n\n      case 2:\n        setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n          three: form\n        }));\n        canContinue = handleSubmit(_objectSpread(_objectSpread({}, compiledForm), {}, {\n          three: form\n        }));\n        break;\n\n      case 3:\n        console.log(form);\n        break;\n\n      default:\n        return 'not a valid step';\n    }\n\n    if (canContinue) {\n      setActiveStep(prevActiveStep => prevActiveStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (activeStep > 0) {\n      setActiveStep(prevActiveStep => prevActiveStep - 1);\n\n      switch (activeStep) {\n        case 1:\n          setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n            solicitud: form\n          }));\n          break;\n\n        case 2:\n          setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n            prestaciones: form\n          }));\n          break;\n\n        default:\n          return 'not a valid step';\n      }\n    } else {\n      setShowStepper(false);\n    }\n  };\n\n  const handleReset = () => {\n    setActiveStep(0);\n    setCompiledForm({});\n    setPrestaciones(null);\n    setSolicitud(null);\n    setShowStepper(false);\n  };\n\n  const handleSubmit = async form => {\n    if (_.isEmpty(errors)) {\n      var _form$solicitud;\n\n      form.solicitud.fechaAlta = format(form === null || form === void 0 ? void 0 : (_form$solicitud = form.solicitud) === null || _form$solicitud === void 0 ? void 0 : _form$solicitud.fechaAlta, 'yyyy-MM-dd');\n      form.solicitud.afiliado = form.solicitud.afiliado.id;\n      form.solicitud.delegacion = form.solicitud.delegacion.id;\n\n      try {\n        var _solicitud$data;\n\n        //Remove the key used for show prestaciones list on step 2 before send to server\n        const presAux = prestaciones.map(elem => {\n          const aux = _objectSpread({}, elem);\n\n          delete aux.item;\n          return aux;\n        });\n        const solicitud = await post(SOLICITUDES.route, {\n          solicitud: _objectSpread({}, form.solicitud),\n          prestaciones: presAux\n        });\n        setPrestaciones([...(solicitud === null || solicitud === void 0 ? void 0 : (_solicitud$data = solicitud.data) === null || _solicitud$data === void 0 ? void 0 : _solicitud$data.prestaciones.map(p => _objectSpread(_objectSpread({}, p), {}, {\n          item: p.nomenclador\n        })))]);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Stepper, {\n      activeStep: activeStep,\n      children: steps.map((label, index) => {\n        const stepProps = {};\n        const labelProps = {};\n        return /*#__PURE__*/_jsxDEV(Step, _objectSpread(_objectSpread({}, stepProps), {}, {\n          children: /*#__PURE__*/_jsxDEV(StepLabel, _objectSpread(_objectSpread({}, labelProps), {}, {\n            children: label\n          }), void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 15\n          }, this)\n        }), label, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 13\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      children: activeStep === steps.length ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: STEPPER_SOLICITUDES.end\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: handleReset,\n            children: STEPPER_SOLICITUDES.close\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [getStepContent(activeStep, compiledForm), /*#__PURE__*/_jsxDEV(Box, {\n          className: classes.stepperButtons,\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            onClick: handleBack,\n            className: classes.button,\n            children: activeStep === 0 ? STEPPER_SOLICITUDES.cancel : STEPPER_SOLICITUDES.back\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            className: classes.button,\n            color: \"primary\",\n            onClick: handleNext,\n            children: activeStep === steps.length - 1 ? STEPPER_SOLICITUDES.finish : STEPPER_SOLICITUDES.next\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};","map":{"version":3,"sources":["/reintegros/reintegros-frontend/components/solicitudes/Stepper.tsx"],"names":["React","useFormContext","Stepper","Step","StepLabel","Button","_","Typography","format","get","post","SOLICITUDES","STEPPER_SOLICITUDES","useStyles","Box","FormSolicitud","FormPrestaciones","FormAdjuntos","SolicitudesSummary","FormStepper","setShowStepper","watch","errors","trigger","activeStep","setActiveStep","useState","compiledForm","setCompiledForm","steps","map","elem","title","form","prestaciones","setPrestaciones","solicitud","setSolicitud","classes","addPrestacion","factura","fechaPractica","cobertura","parseInt","coseguroNomenclador","parseFloat","toFixed","nomenclador","item","data","removePrestacion","id","filter","index","getStepContent","step","formContent","handleNext","canContinue","result","three","handleSubmit","console","log","prevActiveStep","handleBack","handleReset","isEmpty","fechaAlta","afiliado","delegacion","presAux","aux","route","p","error","label","stepProps","labelProps","length","end","close","stepperButtons","button","cancel","back","finish","next"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport _ from 'lodash';\nimport Typography from '@material-ui/core/Typography';\nimport { format } from 'date-fns';\nimport { get, post } from '../api-call/service';\nimport { SOLICITUDES, STEPPER_SOLICITUDES } from '../../labels';\nimport useStyles from './Stepper.styles';\nimport { Box } from '@material-ui/core';\nimport { FormSolicitud } from './FormSolicitud';\nimport { FormPrestaciones } from './prestaciones/FormPrestaciones';\n\nimport { FormAdjuntos } from './adjuntos/FormAdjuntos';\nimport SolicitudesSummary from './SolicitudesSummary';\n\nexport const FormStepper = ({ setShowStepper }) => {\n  const { watch, errors, trigger } = useFormContext();\n  const [activeStep, setActiveStep] = React.useState(0);\n  const [compiledForm, setCompiledForm] = React.useState({});\n  const steps = STEPPER_SOLICITUDES.steps.map((elem) => elem.title);\n  const form = watch();\n  const [prestaciones, setPrestaciones] = React.useState([]);\n  const [solicitud, setSolicitud] = React.useState(null);\n\n  const classes = useStyles();\n\n  const addPrestacion = async (factura) => {\n    form.fechaPractica = format(form?.fechaPractica, 'yyyy-MM-dd');\n    form.cobertura = parseInt(form.cobertura);\n    form.coseguroNomenclador = parseFloat(form.coseguroNomenclador).toFixed(2);\n    const nomenclador = await get(`/nomenclador/${form?.nomenclador}`);\n    setPrestaciones([...prestaciones, { ...form, factura, item: nomenclador?.data }]);\n  };\n  const removePrestacion = (id) => {\n    setPrestaciones([...prestaciones.filter((_, index) => index !== id)]);\n  };\n\n  function getStepContent(step, formContent) {\n    switch (step) {\n      case 0:\n        return <FormSolicitud {...{ formContent }} step={STEPPER_SOLICITUDES.steps[step]} />;\n      case 1:\n        return (\n          <FormPrestaciones\n            {...{ formContent }}\n            step={STEPPER_SOLICITUDES.steps[step]}\n            addPrestacion={addPrestacion}\n            prestaciones={prestaciones}\n            removePrestacion={removePrestacion}\n          />\n        );\n      case 2:\n        return (\n          <SolicitudesSummary\n            solicitud={solicitud}\n            prestaciones={prestaciones}\n            header={true}\n            step={STEPPER_SOLICITUDES.steps[step]}\n          />\n        );\n      case 3:\n        return <FormAdjuntos prestaciones={prestaciones} step={STEPPER_SOLICITUDES.steps[step]} />;\n\n      default:\n        return 'Unknown step';\n    }\n  }\n  const handleNext = async () => {\n    let canContinue = true;\n\n    const result = await trigger();\n    if (!result) {\n      return;\n    }\n    switch (activeStep) {\n      case 0:\n        setCompiledForm({ ...compiledForm, solicitud: form });\n        setSolicitud({ ...form });\n        canContinue = true;\n\n        break;\n      case 1:\n        setCompiledForm({ ...compiledForm, prestaciones: prestaciones });\n        canContinue = true;\n        break;\n\n      case 2:\n        setCompiledForm({ ...compiledForm, three: form });\n        canContinue = handleSubmit({ ...compiledForm, three: form });\n        break;\n      case 3:\n        console.log(form);\n        break;\n      default:\n        return 'not a valid step';\n    }\n    if (canContinue) {\n      setActiveStep((prevActiveStep) => prevActiveStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (activeStep > 0) {\n      setActiveStep((prevActiveStep) => prevActiveStep - 1);\n      switch (activeStep) {\n        case 1:\n          setCompiledForm({ ...compiledForm, solicitud: form });\n          break;\n        case 2:\n          setCompiledForm({ ...compiledForm, prestaciones: form });\n          break;\n        default:\n          return 'not a valid step';\n      }\n    } else {\n      setShowStepper(false);\n    }\n  };\n\n  const handleReset = () => {\n    setActiveStep(0);\n    setCompiledForm({});\n    setPrestaciones(null);\n    setSolicitud(null);\n    setShowStepper(false);\n  };\n\n  const handleSubmit = async (form) => {\n    if (_.isEmpty(errors)) {\n      form.solicitud.fechaAlta = format(form?.solicitud?.fechaAlta, 'yyyy-MM-dd');\n      form.solicitud.afiliado = form.solicitud.afiliado.id;\n      form.solicitud.delegacion = form.solicitud.delegacion.id;\n      try {\n        //Remove the key used for show prestaciones list on step 2 before send to server\n        const presAux = prestaciones.map((elem) => {\n          const aux = { ...elem };\n          delete aux.item;\n          return aux;\n        });\n\n        const solicitud = await post(SOLICITUDES.route, {\n          solicitud: { ...form.solicitud },\n          prestaciones: presAux,\n        });\n\n        setPrestaciones([\n          ...solicitud?.data?.prestaciones.map((p) => ({ ...p, item: p.nomenclador })),\n        ]);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  return (\n    <>\n      <Stepper activeStep={activeStep}>\n        {steps.map((label, index) => {\n          const stepProps = {};\n          const labelProps = {};\n          return (\n            <Step key={label} {...stepProps}>\n              <StepLabel {...labelProps}>{label}</StepLabel>\n            </Step>\n          );\n        })}\n      </Stepper>\n      <Box>\n        {activeStep === steps.length ? (\n          <>\n            <>\n              <Typography>{STEPPER_SOLICITUDES.end}</Typography>\n              <Button onClick={handleReset}>{STEPPER_SOLICITUDES.close}</Button>\n            </>\n          </>\n        ) : (\n          <>\n            {getStepContent(activeStep, compiledForm)}\n            <Box className={classes.stepperButtons}>\n              <Button onClick={handleBack} className={classes.button}>\n                {activeStep === 0 ? STEPPER_SOLICITUDES.cancel : STEPPER_SOLICITUDES.back}\n              </Button>\n              <Button\n                variant=\"contained\"\n                className={classes.button}\n                color=\"primary\"\n                onClick={handleNext}\n              >\n                {activeStep === steps.length - 1\n                  ? STEPPER_SOLICITUDES.finish\n                  : STEPPER_SOLICITUDES.next}\n              </Button>\n            </Box>\n          </>\n        )}\n      </Box>\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}