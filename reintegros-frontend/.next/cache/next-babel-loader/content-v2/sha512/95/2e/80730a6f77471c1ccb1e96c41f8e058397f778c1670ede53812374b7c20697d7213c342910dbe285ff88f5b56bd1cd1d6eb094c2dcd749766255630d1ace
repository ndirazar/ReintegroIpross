{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Box, Button, Typography } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport { ERRORS, LOADING } from '../../../labels';\nimport { ListaPrestacion } from '../prestaciones/ListaPrestaciones';\nimport AttachFileIcon from '@material-ui/icons/AttachFile';\nimport { send } from '../../api-call/service';\nimport Form from '../../builder';\nimport configAdjuntos from './FormConfig';\nimport PublishIcon from '@material-ui/icons/Publish';\nimport useStyles from '../Stepper.styles';\nimport useLoading from '../../common/hooks/Loading';\nimport Loading from '../../common/Loading';\nimport Alert from '../../common/Alert';\nexport const FormAdjuntos = ({\n  prestaciones,\n  step\n}) => {\n  const {\n    0: prestacion,\n    1: setPrestacion\n  } = useState(null);\n  const {\n    0: error,\n    1: setError\n  } = useState(null);\n  const classes = useStyles();\n  const {\n    loading,\n    isLoading,\n    unsetLoading\n  } = useLoading();\n\n  const submitAdjuntos = async data => {\n    setError(null);\n\n    try {\n      const formData = new FormData();\n\n      for (const ad of data.adjuntos) {\n        formData.append('archivos', ad);\n      }\n\n      formData.append('etiqueta', '1');\n      formData.append('prestacion', prestacion);\n      const resAdjuntos = await send({\n        url: 'api/archivos-adjuntos/',\n        data: formData,\n        method: 'POST',\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        },\n        onUploadProgress: progressEvent => {\n          isLoading();\n        }\n      });\n\n      if (resAdjuntos.status === 200) {\n        // console.log(resAdjuntos);\n        setPrestacion(null);\n      }\n    } catch (error) {\n      setError(ERRORS.onUpload);\n    } finally {\n      unsetLoading();\n    }\n  };\n\n  const handlePrestacion = index => {\n    var _prestaciones$index;\n\n    setPrestacion((_prestaciones$index = prestaciones[index]) === null || _prestaciones$index === void 0 ? void 0 : _prestaciones$index.id);\n  };\n\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Box, {\n      children: [/*#__PURE__*/_jsx(Typography, {\n        variant: \"h5\",\n        gutterBottom: true,\n        children: step.title\n      }), /*#__PURE__*/_jsx(Typography, {\n        variant: \"subtitle1\",\n        gutterBottom: true,\n        children: step.description\n      })]\n    }), /*#__PURE__*/_jsx(ListaPrestacion, {\n      prestaciones: prestaciones,\n      buttons: [{\n        action: handlePrestacion,\n        icon: /*#__PURE__*/_jsx(AttachFileIcon, {})\n      }]\n    }), prestacion && /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsx(Form, {\n        config: configAdjuntos,\n        data: {\n          adjuntos: []\n        },\n        onSubmit: submitAdjuntos,\n        submitButton: /*#__PURE__*/_jsx(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          type: \"submit\",\n          endIcon: /*#__PURE__*/_jsx(PublishIcon, {}),\n          className: classes.button,\n          children: \"Subir\"\n        }),\n        buttonsWidth: 5\n      }), /*#__PURE__*/_jsx(Loading, {\n        loading: loading,\n        message: LOADING('adjuntos')\n      }), /*#__PURE__*/_jsx(Alert, {\n        open: error || false,\n        severity: \"error\",\n        message: error && ERRORS[error]\n      })]\n    })]\n  });\n};","map":null,"metadata":{},"sourceType":"module"}