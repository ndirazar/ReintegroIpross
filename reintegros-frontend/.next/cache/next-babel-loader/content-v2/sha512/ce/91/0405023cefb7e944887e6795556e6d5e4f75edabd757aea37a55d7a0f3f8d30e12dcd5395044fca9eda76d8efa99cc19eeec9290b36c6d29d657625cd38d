{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _defineProperty from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _asyncToGenerator from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/reintegros/reintegros-frontend/components/solicitudes/Stepper.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport _ from 'lodash';\nimport Typography from '@material-ui/core/Typography';\nimport { format } from 'date-fns';\nimport { get, post } from '../api-call/service';\nimport { SOLICITUDES, STEPPER_SOLICITUDES } from '../../labels';\nimport useStyles from './Stepper.styles';\nimport { Box } from '@material-ui/core';\nimport { FormSolicitud } from './FormSolicitud';\nimport { FormPrestaciones } from './prestaciones/FormPrestaciones';\nimport { FormAdjuntos } from './adjuntos/FormAdjuntos';\nimport SolicitudesSummary from './SolicitudesSummary';\nexport var FormStepper = function FormStepper(_ref) {\n  _s();\n\n  var setShowStepper = _ref.setShowStepper;\n\n  var _useFormContext = useFormContext(),\n      watch = _useFormContext.watch,\n      errors = _useFormContext.errors,\n      trigger = _useFormContext.trigger;\n\n  var _React$useState = React.useState(0),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      activeStep = _React$useState2[0],\n      setActiveStep = _React$useState2[1];\n\n  var _React$useState3 = React.useState({}),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      compiledForm = _React$useState4[0],\n      setCompiledForm = _React$useState4[1];\n\n  var steps = STEPPER_SOLICITUDES.steps.map(function (elem) {\n    return elem.title;\n  });\n  var form = watch();\n\n  var _React$useState5 = React.useState([]),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      prestaciones = _React$useState6[0],\n      setPrestaciones = _React$useState6[1];\n\n  var _React$useState7 = React.useState(null),\n      _React$useState8 = _slicedToArray(_React$useState7, 2),\n      solicitud = _React$useState8[0],\n      setSolicitud = _React$useState8[1];\n\n  var classes = useStyles();\n\n  var addPrestacion = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(factura) {\n      var nomenclador;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              form.fechaPractica = format(form === null || form === void 0 ? void 0 : form.fechaPractica, 'yyyy-MM-dd');\n              form.cobertura = parseInt(form.cobertura);\n              form.coseguroNomenclador = parseFloat(form.coseguroNomenclador).toFixed(2);\n              _context.next = 5;\n              return get(\"/nomenclador/\".concat(form === null || form === void 0 ? void 0 : form.nomenclador));\n\n            case 5:\n              nomenclador = _context.sent;\n              setPrestaciones([].concat(_toConsumableArray(prestaciones), [_objectSpread(_objectSpread({}, form), {}, {\n                factura: factura,\n                item: nomenclador === null || nomenclador === void 0 ? void 0 : nomenclador.data\n              })]));\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function addPrestacion(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var removePrestacion = function removePrestacion(id) {\n    setPrestaciones(_toConsumableArray(prestaciones.filter(function (_, index) {\n      return index !== id;\n    })));\n  };\n\n  function getStepContent(step, formContent) {\n    switch (step) {\n      case 0:\n        return /*#__PURE__*/_jsxDEV(FormSolicitud, _objectSpread(_objectSpread({}, {\n          formContent: formContent\n        }), {}, {\n          step: STEPPER_SOLICITUDES.steps[step]\n        }), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 45,\n          columnNumber: 16\n        }, this);\n\n      case 1:\n        return /*#__PURE__*/_jsxDEV(FormPrestaciones, _objectSpread(_objectSpread({}, {\n          formContent: formContent\n        }), {}, {\n          step: STEPPER_SOLICITUDES.steps[step],\n          addPrestacion: addPrestacion,\n          prestaciones: prestaciones,\n          removePrestacion: removePrestacion\n        }), void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 48,\n          columnNumber: 11\n        }, this);\n\n      case 2:\n        return /*#__PURE__*/_jsxDEV(SolicitudesSummary, {\n          solicitud: solicitud,\n          prestaciones: prestaciones,\n          header: true,\n          step: STEPPER_SOLICITUDES.steps[step]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 58,\n          columnNumber: 11\n        }, this);\n\n      case 3:\n        return /*#__PURE__*/_jsxDEV(FormAdjuntos, {\n          prestaciones: prestaciones,\n          step: STEPPER_SOLICITUDES.steps[step]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 66,\n          columnNumber: 16\n        }, this);\n\n      default:\n        return 'Unknown step';\n    }\n  }\n\n  var handleNext = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var canContinue, result;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              canContinue = true;\n              _context2.next = 3;\n              return trigger();\n\n            case 3:\n              result = _context2.sent;\n\n              if (result) {\n                _context2.next = 6;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 6:\n              _context2.t0 = activeStep;\n              _context2.next = _context2.t0 === 0 ? 9 : _context2.t0 === 1 ? 13 : _context2.t0 === 2 ? 16 : _context2.t0 === 3 ? 19 : 21;\n              break;\n\n            case 9:\n              setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n                solicitud: form\n              }));\n              setSolicitud(_objectSpread({}, form));\n              canContinue = true;\n              return _context2.abrupt(\"break\", 22);\n\n            case 13:\n              setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n                prestaciones: prestaciones\n              }));\n              canContinue = true;\n              return _context2.abrupt(\"break\", 22);\n\n            case 16:\n              setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n                three: form\n              }));\n              canContinue = handleSubmit(_objectSpread(_objectSpread({}, compiledForm), {}, {\n                three: form\n              }));\n              return _context2.abrupt(\"break\", 22);\n\n            case 19:\n              console.log(form);\n              return _context2.abrupt(\"break\", 22);\n\n            case 21:\n              return _context2.abrupt(\"return\", 'not a valid step');\n\n            case 22:\n              if (canContinue) {\n                setActiveStep(function (prevActiveStep) {\n                  return prevActiveStep + 1;\n                });\n              }\n\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleNext() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleBack = function handleBack() {\n    if (activeStep > 0) {\n      setActiveStep(function (prevActiveStep) {\n        return prevActiveStep - 1;\n      });\n\n      switch (activeStep) {\n        case 1:\n          setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n            solicitud: form\n          }));\n          break;\n\n        case 2:\n          setCompiledForm(_objectSpread(_objectSpread({}, compiledForm), {}, {\n            prestaciones: form\n          }));\n          break;\n\n        default:\n          return 'not a valid step';\n      }\n    } else {\n      setShowStepper(false);\n    }\n  };\n\n  var handleReset = function handleReset() {\n    setActiveStep(0);\n    setCompiledForm({});\n    setPrestaciones(null);\n    setSolicitud(null);\n    setShowStepper(false);\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(form) {\n      var _form$solicitud, _solicitud$data, presAux, _solicitud;\n\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (!_.isEmpty(errors)) {\n                _context3.next = 15;\n                break;\n              }\n\n              form.solicitud.fechaAlta = format(form === null || form === void 0 ? void 0 : (_form$solicitud = form.solicitud) === null || _form$solicitud === void 0 ? void 0 : _form$solicitud.fechaAlta, 'yyyy-MM-dd');\n              form.solicitud.afiliado = form.solicitud.afiliado.id;\n              form.solicitud.delegacion = form.solicitud.delegacion.id;\n              _context3.prev = 4;\n              //Remove the key used for show prestaciones list on step 2 before send to server\n              presAux = prestaciones.map(function (elem) {\n                var aux = _objectSpread({}, elem);\n\n                delete aux.item;\n                return aux;\n              });\n              _context3.next = 8;\n              return post(SOLICITUDES.route, {\n                solicitud: _objectSpread({}, form.solicitud),\n                prestaciones: presAux\n              });\n\n            case 8:\n              _solicitud = _context3.sent;\n              setPrestaciones(_toConsumableArray(_solicitud === null || _solicitud === void 0 ? void 0 : (_solicitud$data = _solicitud.data) === null || _solicitud$data === void 0 ? void 0 : _solicitud$data.prestaciones.map(function (p) {\n                return _objectSpread(_objectSpread({}, p), {}, {\n                  item: p.nomenclador\n                });\n              })));\n              _context3.next = 15;\n              break;\n\n            case 12:\n              _context3.prev = 12;\n              _context3.t0 = _context3[\"catch\"](4);\n              console.log(_context3.t0);\n\n            case 15:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[4, 12]]);\n    }));\n\n    return function handleSubmit(_x2) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Stepper, {\n      activeStep: activeStep,\n      children: steps.map(function (label, index) {\n        var stepProps = {};\n        var labelProps = {};\n        return /*#__PURE__*/_jsxDEV(Step, _objectSpread(_objectSpread({}, stepProps), {}, {\n          children: /*#__PURE__*/_jsxDEV(StepLabel, _objectSpread(_objectSpread({}, labelProps), {}, {\n            children: label\n          }), void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 167,\n            columnNumber: 15\n          }, _this)\n        }), label, false, {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 13\n        }, _this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 7\n    }, _this), /*#__PURE__*/_jsxDEV(Box, {\n      children: activeStep === steps.length ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            children: STEPPER_SOLICITUDES.end\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 176,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(Button, {\n            onClick: handleReset,\n            children: STEPPER_SOLICITUDES.close\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true)\n      }, void 0, false) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [getStepContent(activeStep, compiledForm), /*#__PURE__*/_jsxDEV(Box, {\n          className: classes.stepperButtons,\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            onClick: handleBack,\n            className: classes.button,\n            children: activeStep === 0 ? STEPPER_SOLICITUDES.cancel : STEPPER_SOLICITUDES.back\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 15\n          }, _this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            className: classes.button,\n            color: \"primary\",\n            onClick: handleNext,\n            children: activeStep === steps.length - 1 ? STEPPER_SOLICITUDES.finish : STEPPER_SOLICITUDES.next\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 15\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(FormStepper, \"Q5BHz1JNovnn/VOSkMLvAAobSso=\", false, function () {\n  return [useFormContext, useStyles];\n});\n\n_c = FormStepper;\n\nvar _c;\n\n$RefreshReg$(_c, \"FormStepper\");","map":{"version":3,"sources":["/reintegros/reintegros-frontend/components/solicitudes/Stepper.tsx"],"names":["React","useFormContext","Stepper","Step","StepLabel","Button","_","Typography","format","get","post","SOLICITUDES","STEPPER_SOLICITUDES","useStyles","Box","FormSolicitud","FormPrestaciones","FormAdjuntos","SolicitudesSummary","FormStepper","setShowStepper","watch","errors","trigger","useState","activeStep","setActiveStep","compiledForm","setCompiledForm","steps","map","elem","title","form","prestaciones","setPrestaciones","solicitud","setSolicitud","classes","addPrestacion","factura","fechaPractica","cobertura","parseInt","coseguroNomenclador","parseFloat","toFixed","nomenclador","item","data","removePrestacion","id","filter","index","getStepContent","step","formContent","handleNext","canContinue","result","three","handleSubmit","console","log","prevActiveStep","handleBack","handleReset","isEmpty","fechaAlta","afiliado","delegacion","presAux","aux","route","p","label","stepProps","labelProps","length","end","close","stepperButtons","button","cancel","back","finish","next"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Button from '@material-ui/core/Button';\nimport _ from 'lodash';\nimport Typography from '@material-ui/core/Typography';\nimport { format } from 'date-fns';\nimport { get, post } from '../api-call/service';\nimport { SOLICITUDES, STEPPER_SOLICITUDES } from '../../labels';\nimport useStyles from './Stepper.styles';\nimport { Box } from '@material-ui/core';\nimport { FormSolicitud } from './FormSolicitud';\nimport { FormPrestaciones } from './prestaciones/FormPrestaciones';\n\nimport { FormAdjuntos } from './adjuntos/FormAdjuntos';\nimport SolicitudesSummary from './SolicitudesSummary';\n\nexport const FormStepper = ({ setShowStepper }) => {\n  const { watch, errors, trigger } = useFormContext();\n  const [activeStep, setActiveStep] = React.useState(0);\n  const [compiledForm, setCompiledForm] = React.useState({});\n  const steps = STEPPER_SOLICITUDES.steps.map((elem) => elem.title);\n  const form = watch();\n  const [prestaciones, setPrestaciones] = React.useState([]);\n  const [solicitud, setSolicitud] = React.useState(null);\n\n  const classes = useStyles();\n\n  const addPrestacion = async (factura) => {\n    form.fechaPractica = format(form?.fechaPractica, 'yyyy-MM-dd');\n    form.cobertura = parseInt(form.cobertura);\n    form.coseguroNomenclador = parseFloat(form.coseguroNomenclador).toFixed(2);\n    const nomenclador = await get(`/nomenclador/${form?.nomenclador}`);\n    setPrestaciones([...prestaciones, { ...form, factura, item: nomenclador?.data }]);\n  };\n  const removePrestacion = (id) => {\n    setPrestaciones([...prestaciones.filter((_, index) => index !== id)]);\n  };\n\n  function getStepContent(step, formContent) {\n    switch (step) {\n      case 0:\n        return <FormSolicitud {...{ formContent }} step={STEPPER_SOLICITUDES.steps[step]} />;\n      case 1:\n        return (\n          <FormPrestaciones\n            {...{ formContent }}\n            step={STEPPER_SOLICITUDES.steps[step]}\n            addPrestacion={addPrestacion}\n            prestaciones={prestaciones}\n            removePrestacion={removePrestacion}\n          />\n        );\n      case 2:\n        return (\n          <SolicitudesSummary\n            solicitud={solicitud}\n            prestaciones={prestaciones}\n            header={true}\n            step={STEPPER_SOLICITUDES.steps[step]}\n          />\n        );\n      case 3:\n        return <FormAdjuntos prestaciones={prestaciones} step={STEPPER_SOLICITUDES.steps[step]} />;\n\n      default:\n        return 'Unknown step';\n    }\n  }\n  const handleNext = async () => {\n    let canContinue = true;\n\n    const result = await trigger();\n    if (!result) {\n      return;\n    }\n    switch (activeStep) {\n      case 0:\n        setCompiledForm({ ...compiledForm, solicitud: form });\n        setSolicitud({ ...form });\n        canContinue = true;\n\n        break;\n      case 1:\n        setCompiledForm({ ...compiledForm, prestaciones: prestaciones });\n        canContinue = true;\n        break;\n\n      case 2:\n        setCompiledForm({ ...compiledForm, three: form });\n        canContinue = handleSubmit({ ...compiledForm, three: form });\n        break;\n      case 3:\n        console.log(form);\n        break;\n      default:\n        return 'not a valid step';\n    }\n    if (canContinue) {\n      setActiveStep((prevActiveStep) => prevActiveStep + 1);\n    }\n  };\n\n  const handleBack = () => {\n    if (activeStep > 0) {\n      setActiveStep((prevActiveStep) => prevActiveStep - 1);\n      switch (activeStep) {\n        case 1:\n          setCompiledForm({ ...compiledForm, solicitud: form });\n          break;\n        case 2:\n          setCompiledForm({ ...compiledForm, prestaciones: form });\n          break;\n        default:\n          return 'not a valid step';\n      }\n    } else {\n      setShowStepper(false);\n    }\n  };\n\n  const handleReset = () => {\n    setActiveStep(0);\n    setCompiledForm({});\n    setPrestaciones(null);\n    setSolicitud(null);\n    setShowStepper(false);\n  };\n\n  const handleSubmit = async (form) => {\n    if (_.isEmpty(errors)) {\n      form.solicitud.fechaAlta = format(form?.solicitud?.fechaAlta, 'yyyy-MM-dd');\n      form.solicitud.afiliado = form.solicitud.afiliado.id;\n      form.solicitud.delegacion = form.solicitud.delegacion.id;\n      try {\n        //Remove the key used for show prestaciones list on step 2 before send to server\n        const presAux = prestaciones.map((elem) => {\n          const aux = { ...elem };\n          delete aux.item;\n          return aux;\n        });\n\n        const solicitud = await post(SOLICITUDES.route, {\n          solicitud: { ...form.solicitud },\n          prestaciones: presAux,\n        });\n\n        setPrestaciones([\n          ...solicitud?.data?.prestaciones.map((p) => ({ ...p, item: p.nomenclador })),\n        ]);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  };\n\n  return (\n    <>\n      <Stepper activeStep={activeStep}>\n        {steps.map((label, index) => {\n          const stepProps = {};\n          const labelProps = {};\n          return (\n            <Step key={label} {...stepProps}>\n              <StepLabel {...labelProps}>{label}</StepLabel>\n            </Step>\n          );\n        })}\n      </Stepper>\n      <Box>\n        {activeStep === steps.length ? (\n          <>\n            <>\n              <Typography>{STEPPER_SOLICITUDES.end}</Typography>\n              <Button onClick={handleReset}>{STEPPER_SOLICITUDES.close}</Button>\n            </>\n          </>\n        ) : (\n          <>\n            {getStepContent(activeStep, compiledForm)}\n            <Box className={classes.stepperButtons}>\n              <Button onClick={handleBack} className={classes.button}>\n                {activeStep === 0 ? STEPPER_SOLICITUDES.cancel : STEPPER_SOLICITUDES.back}\n              </Button>\n              <Button\n                variant=\"contained\"\n                className={classes.button}\n                color=\"primary\"\n                onClick={handleNext}\n              >\n                {activeStep === steps.length - 1\n                  ? STEPPER_SOLICITUDES.finish\n                  : STEPPER_SOLICITUDES.next}\n              </Button>\n            </Box>\n          </>\n        )}\n      </Box>\n    </>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}