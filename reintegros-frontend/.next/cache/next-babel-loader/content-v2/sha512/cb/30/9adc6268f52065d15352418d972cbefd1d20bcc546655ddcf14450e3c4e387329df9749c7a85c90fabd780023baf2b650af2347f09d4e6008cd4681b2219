{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { Box, Typography, Grid, IconButton } from '@material-ui/core';\nimport React, { useState, useEffect } from 'react';\nimport { useFormContext } from 'react-hook-form';\nimport FieldRender from '../builder/FieldRender';\nimport configSolicitudes from './FormConfig';\nimport AfiliadosSearch from '../afiliados/AfiliadosSearch';\nimport { SOLICITUDES } from '../../labels';\nimport { FieldType } from '../builder/FormField';\nimport { send } from '../api-call/service';\nimport Tooltip from '@material-ui/core/Tooltip';\nimport { Help } from '@material-ui/icons';\nimport { getUser } from '../common/helpers';\nimport useStyles from './Stepper.styles';\nexport var FormSolicitud = function FormSolicitud(_ref) {\n  var _formContent$solicitu, _formContent$solicitu4, _formContent$solicitu5;\n\n  var formContent = _ref.formContent,\n      step = _ref.step;\n  var methods = useFormContext();\n\n  var _useState = useState(formContent === null || formContent === void 0 ? void 0 : (_formContent$solicitu = formContent.solicitud) === null || _formContent$solicitu === void 0 ? void 0 : _formContent$solicitu.afiliado),\n      afiliado = _useState[0],\n      setAfiliado = _useState[1];\n\n  var user = getUser();\n\n  var _useState2 = useState(null),\n      dataCuenta = _useState2[0],\n      setDataCuenta = _useState2[1];\n\n  var _useState3 = useState(false),\n      errorCuenta = _useState3[0],\n      setErrorcuenta = _useState3[1];\n\n  var _useState4 = useState([]),\n      cuentaOpts = _useState4[0],\n      setCuentaOpts = _useState4[1];\n\n  var _useState5 = useState(null),\n      factura = _useState5[0],\n      setFactura = _useState5[1];\n\n  var classes = useStyles();\n\n  var handleSelectAfiliado = function handleSelectAfiliado(af) {\n    methods.setValue('solicitud.afiliado', af);\n    setAfiliado(af);\n  };\n\n  var tipoConfig = {\n    name: 'tipo',\n    type: FieldType.radio,\n    label: 'Definir si la solicitud se encuentra judicializada',\n    styling: {\n      columns: 3\n    },\n    rules: {\n      required: true\n    },\n    options: [{\n      value: 'judicial',\n      label: 'Si'\n    }, {\n      value: 'noJudicial',\n      label: 'No'\n    }]\n  };\n\n  var getDataCuenta = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(tipoCuenta) {\n      var cuentaJudicial, cuentaDeTerceros;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (tipoCuenta === 'cuentaAfiliado') {\n                setErrorcuenta(false);\n                setDataCuenta({\n                  nombre: afiliado === null || afiliado === void 0 ? void 0 : afiliado.nombre,\n                  apellido: afiliado === null || afiliado === void 0 ? void 0 : afiliado.apelido,\n                  cbu: afiliado === null || afiliado === void 0 ? void 0 : afiliado.cbu,\n                  cuitCuil: afiliado === null || afiliado === void 0 ? void 0 : afiliado.cuitCuil\n                });\n              }\n\n              if (!(tipoCuenta === 'cuentaJudicial' && afiliado !== null && afiliado !== void 0 && afiliado.cuentajudicial)) {\n                _context.next = 13;\n                break;\n              }\n\n              setErrorcuenta(false);\n              _context.prev = 3;\n              _context.next = 6;\n              return send({\n                url: \"api/cuenta-judicial/\".concat(afiliado === null || afiliado === void 0 ? void 0 : afiliado.cuentajudicial),\n                method: 'GET',\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 6:\n              cuentaJudicial = _context.sent;\n              setDataCuenta({\n                nombre: cuentaJudicial === null || cuentaJudicial === void 0 ? void 0 : cuentaJudicial.data.nombre,\n                apellido: cuentaJudicial === null || cuentaJudicial === void 0 ? void 0 : cuentaJudicial.data.apellido,\n                cbu: cuentaJudicial === null || cuentaJudicial === void 0 ? void 0 : cuentaJudicial.data.cbu,\n                cuitCuil: cuentaJudicial === null || cuentaJudicial === void 0 ? void 0 : cuentaJudicial.data.cuitCuil\n              });\n              _context.next = 13;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](3);\n              setErrorcuenta(true);\n\n            case 13:\n              if (!(tipoCuenta === 'cuentaDeTerceros' && afiliado !== null && afiliado !== void 0 && afiliado.cuentadeterceros)) {\n                _context.next = 25;\n                break;\n              }\n\n              setErrorcuenta(false);\n              _context.prev = 15;\n              _context.next = 18;\n              return send({\n                url: \"api/cuenta-de-terceros/\".concat(afiliado === null || afiliado === void 0 ? void 0 : afiliado.cuentadeterceros),\n                method: 'GET',\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 18:\n              cuentaDeTerceros = _context.sent;\n              setDataCuenta({\n                nombre: cuentaDeTerceros === null || cuentaDeTerceros === void 0 ? void 0 : cuentaDeTerceros.data.nombre,\n                apellido: cuentaDeTerceros === null || cuentaDeTerceros === void 0 ? void 0 : cuentaDeTerceros.data.apellido,\n                cbu: cuentaDeTerceros === null || cuentaDeTerceros === void 0 ? void 0 : cuentaDeTerceros.data.cbu,\n                cuitCuil: cuentaDeTerceros === null || cuentaDeTerceros === void 0 ? void 0 : cuentaDeTerceros.data.cuitCuil\n              });\n              _context.next = 25;\n              break;\n\n            case 22:\n              _context.prev = 22;\n              _context.t1 = _context[\"catch\"](15);\n              setErrorcuenta(true);\n\n            case 25:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 10], [15, 22]]);\n    }));\n\n    return function getDataCuenta(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var cuentaConfig = {\n    name: 'cuenta',\n    type: FieldType.options,\n    label: SOLICITUDES.messages.tipoForm,\n    options: cuentaOpts,\n    onChange: getDataCuenta,\n    styling: {\n      columns: 3\n    },\n    rules: {\n      required: true\n    }\n  };\n  var configFactura = {\n    name: 'factura',\n    type: FieldType.file,\n    label: SOLICITUDES.fields['factura.id'],\n    accept: 'text/plain, application/pdf, image/png, image/gif, image/jpeg',\n    styling: {\n      columns: 12\n    },\n    rules: {\n      required: true\n    } // onChange: async (file, form) => {\n    //   try {\n    //     const formData = new FormData();\n    //     formData.append('archivo', file);\n    //     formData.append('etiqueta', '1');\n    //     const resFactura = await send({\n    //       url: 'api/facturas/',\n    //       data: formData,\n    //       method: 'POST',\n    //       headers: {\n    //         'Content-Type': 'multipart/form-data',\n    //       },\n    //     });\n    //     if (resFactura.status === 201) {\n    //       setFactura(resFactura.data);\n    //       form.setValue('solicitud.factura', resFactura.data.id);\n    //       console.log({ Factura: resFactura.data.id });\n    //     }\n    //   } catch (error) {\n    //     console.log(error);\n    //   }\n    // },\n\n  };\n\n  var removeFactura = function removeFactura() {\n    setFactura(null);\n  };\n\n  useEffect(function () {\n    var options = [];\n\n    if (afiliado !== null && afiliado !== void 0 && afiliado.cbu) {\n      options.push({\n        label: 'Cuenta propia del afiliado',\n        value: 'cuentaAfiliado'\n      });\n    }\n\n    if (afiliado !== null && afiliado !== void 0 && afiliado.cuentajudicial && (afiliado === null || afiliado === void 0 ? void 0 : afiliado.estadoCuentaJudicial) == 'activa') {\n      options.push({\n        label: 'Cuenta judicial',\n        value: 'cuentaJudicial'\n      });\n    }\n\n    if (afiliado !== null && afiliado !== void 0 && afiliado.cuentadeterceros && (afiliado === null || afiliado === void 0 ? void 0 : afiliado.estadoCuentaDeTerceros) == 'aprobada') {\n      options.push({\n        label: 'Cuenta de terceros',\n        value: 'cuentaDeTerceros'\n      });\n    }\n\n    if (options.length <= 0) {\n      options.push({\n        label: 'Afiliado sin cuentas asociadas, debe tener al menos una cuenta para crear una solicitud',\n        value: ''\n      });\n    }\n\n    setCuentaOpts(options);\n\n    if (!afiliado) {\n      setDataCuenta(null);\n    }\n  }, [afiliado, setCuentaOpts, setDataCuenta]);\n  useEffect(function () {\n    var _formContent$solicitu2;\n\n    if (formContent !== null && formContent !== void 0 && (_formContent$solicitu2 = formContent.solicitud) !== null && _formContent$solicitu2 !== void 0 && _formContent$solicitu2.cuenta && !dataCuenta) {\n      var _formContent$solicitu3;\n\n      getDataCuenta(formContent === null || formContent === void 0 ? void 0 : (_formContent$solicitu3 = formContent.solicitud) === null || _formContent$solicitu3 === void 0 ? void 0 : _formContent$solicitu3.cuenta);\n    }\n  }, [formContent, getDataCuenta]);\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsxs(Box, {\n      children: [/*#__PURE__*/_jsx(Typography, {\n        variant: \"h5\",\n        gutterBottom: true,\n        children: step.title\n      }), /*#__PURE__*/_jsx(Typography, {\n        variant: \"subtitle1\",\n        gutterBottom: true,\n        children: step.description\n      })]\n    }), /*#__PURE__*/_jsx(\"form\", {\n      children: /*#__PURE__*/_jsxs(Grid, {\n        container: true,\n        spacing: 2,\n        children: [/*#__PURE__*/_jsx(AfiliadosSearch, {\n          form: methods,\n          formContent: formContent,\n          onSelect: handleSelectAfiliado\n        }), /*#__PURE__*/_jsxs(Grid, {\n          container: true,\n          item: true,\n          spacing: 2,\n          children: [/*#__PURE__*/_jsx(Grid, {\n            item: true,\n            md: 3,\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: classes.tipoCuenta,\n              children: [/*#__PURE__*/_jsx(Tooltip, {\n                title: /*#__PURE__*/_jsx(Typography, {\n                  children: SOLICITUDES.messages.toolTipJudicializada\n                }),\n                placement: \"top-start\",\n                arrow: true,\n                children: /*#__PURE__*/_jsx(IconButton, {\n                  \"aria-label\": \"Help\",\n                  className: classes.tipoHelp,\n                  children: /*#__PURE__*/_jsx(Help, {})\n                })\n              }), /*#__PURE__*/_jsx(FieldRender, {\n                field: tipoConfig,\n                form: methods,\n                data: {\n                  tipo: formContent === null || formContent === void 0 ? void 0 : (_formContent$solicitu4 = formContent.solicitud) === null || _formContent$solicitu4 === void 0 ? void 0 : _formContent$solicitu4.tipo\n                }\n              })]\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            md: 3,\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: classes.tipoCuentaSelect,\n              children: /*#__PURE__*/_jsx(FieldRender, {\n                field: cuentaConfig,\n                form: methods,\n                data: {\n                  cuenta: formContent === null || formContent === void 0 ? void 0 : (_formContent$solicitu5 = formContent.solicitud) === null || _formContent$solicitu5 === void 0 ? void 0 : _formContent$solicitu5.cuenta\n                }\n              })\n            })\n          }), /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            md: 3,\n            children: errorCuenta ? /*#__PURE__*/_jsx(\"div\", {\n              className: classes.afiliadoDetail,\n              children: /*#__PURE__*/_jsx(Typography, {\n                component: \"h6\",\n                color: \"error\",\n                children: SOLICITUDES.messages.errorAlObtenerCuenta\n              })\n            }) : dataCuenta && /*#__PURE__*/_jsx(\"div\", {\n              className: classes.afiliadoDetail,\n              children: /*#__PURE__*/_jsx(FieldRender, {\n                form: methods,\n                field: {\n                  name: 'cuentaCBU',\n                  type: FieldType.string,\n                  label: 'CBU',\n                  disabled: true\n                },\n                data: {\n                  cuentaCBU: dataCuenta.cbu\n                }\n              })\n            })\n          })]\n        }), [].concat(_toConsumableArray(configSolicitudes), [configFactura]).map(function (field, index) {\n          var _field$styling, _formContent$solicitu6, _user$delegacionPrinc, _formContent$solicitu7;\n\n          return /*#__PURE__*/_jsx(Grid, {\n            item: true,\n            md: ((_field$styling = field.styling) === null || _field$styling === void 0 ? void 0 : _field$styling.columns) || 12,\n            children: /*#__PURE__*/_jsx(FieldRender, {\n              field: field,\n              form: methods,\n              data: {\n                afiliado: afiliado,\n                discapacitado: false,\n                estadoActual: 'sinPagos',\n                delegacion: (formContent === null || formContent === void 0 ? void 0 : (_formContent$solicitu6 = formContent.solicitud) === null || _formContent$solicitu6 === void 0 ? void 0 : _formContent$solicitu6.delegacion) || (user === null || user === void 0 ? void 0 : (_user$delegacionPrinc = user.delegacionPrincipal) === null || _user$delegacionPrinc === void 0 ? void 0 : _user$delegacionPrinc.id),\n                tipo: 'noJudicial',\n                fechaAlta: new Date().toISOString(),\n                factura: formContent === null || formContent === void 0 ? void 0 : (_formContent$solicitu7 = formContent.solicitud) === null || _formContent$solicitu7 === void 0 ? void 0 : _formContent$solicitu7.factura\n              }\n            })\n          }, index);\n        })]\n      })\n    })]\n  });\n};","map":null,"metadata":{},"sourceType":"module"}