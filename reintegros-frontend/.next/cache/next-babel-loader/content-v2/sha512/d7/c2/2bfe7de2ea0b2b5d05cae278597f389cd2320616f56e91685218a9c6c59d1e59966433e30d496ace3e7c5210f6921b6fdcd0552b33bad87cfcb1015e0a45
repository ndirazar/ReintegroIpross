{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/reintegros/reintegros-frontend/components/users/Users.tsx\",\n    _s = $RefreshSig$();\n\nimport { Box } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport useSWR from 'swr';\nimport UsersForm from './UsersForm';\nimport UsersList from './UsersList';\nimport AutorenewIcon from '@material-ui/icons/Autorenew';\nimport { ERRORS, INFO, LOADING, USERS } from '../../labels';\nimport ActionBar from '../common/ActionBar';\nimport { patch, post } from '../api-call/service';\nimport Loading from '../common/Loading';\nimport Alert from '../common/Alert';\nexport default function Users() {\n  _s();\n\n  var _useSWR = useSWR('api/usuarios'),\n      data = _useSWR.data,\n      errorOnGet = _useSWR.error,\n      mutate = _useSWR.mutate;\n\n  var _useSWR2 = useSWR('api/groups/'),\n      grupos = _useSWR2.data,\n      errorOnGetGroup = _useSWR2.error,\n      mutateGroup = _useSWR2.mutate;\n\n  var _useSWR3 = useSWR('api/delegaciones/'),\n      delegaciones = _useSWR3.data,\n      errorOnGetDelegaciones = _useSWR3.error,\n      mutateDelegacion = _useSWR3.mutate;\n\n  var _useState = useState(false),\n      openForm = _useState[0],\n      setOpenForm = _useState[1];\n\n  var _useState2 = useState(null),\n      error = _useState2[0],\n      setError = _useState2[1];\n\n  var _useState3 = useState(null),\n      info = _useState3[0],\n      setInfo = _useState3[1];\n\n  var handleSetDelegaciones = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(delegacionesSelected, userId) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return patch('api/usuarios', {\n                delegaciones: delegacionesSelected\n              }, userId);\n\n            case 3:\n              setInfo(INFO.setDelegaciones);\n              mutateDelegacion();\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](0);\n              setError('onSetDelegaciones');\n\n            case 10:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n\n    return function handleSetDelegaciones(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleSetGroups = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(groupsSelected, userId) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return patch('api/usuarios', {\n                groups: groupsSelected\n              }, userId);\n\n            case 3:\n              setInfo(INFO.setGroups);\n              mutateGroup();\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              setError('onSetGroups');\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n\n    return function handleSetGroups(_x3, _x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleDeactivate = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(id, state) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              _context3.next = 3;\n              return patch('api/usuarios', {\n                is_active: !state\n              }, id);\n\n            case 3:\n              mutate();\n              _context3.next = 9;\n              break;\n\n            case 6:\n              _context3.prev = 6;\n              _context3.t0 = _context3[\"catch\"](0);\n              setError('onDeactivate');\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 6]]);\n    }));\n\n    return function handleDeactivate(_x5, _x6) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var userActions = [{\n    label: USERS.customActions.sync,\n    onClick: function () {\n      var _onClick = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var _res$data$count, _res$data, res;\n\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return post('api/ldap-sync-users', {});\n\n              case 3:\n                res = _context4.sent;\n                setInfo(INFO.onSync(USERS.name, (_res$data$count = res === null || res === void 0 ? void 0 : (_res$data = res.data) === null || _res$data === void 0 ? void 0 : _res$data.count) !== null && _res$data$count !== void 0 ? _res$data$count : 0));\n                mutate();\n                _context4.next = 11;\n                break;\n\n              case 8:\n                _context4.prev = 8;\n                _context4.t0 = _context4[\"catch\"](0);\n                setError('onSync');\n\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[0, 8]]);\n      }));\n\n      function onClick() {\n        return _onClick.apply(this, arguments);\n      }\n\n      return onClick;\n    }(),\n    icon: /*#__PURE__*/_jsxDEV(AutorenewIcon, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }, this)\n  }];\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(ActionBar, {\n      actions: userActions\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      p: 2,\n      m: 1,\n      border: \"1px solid #c4c4c4\",\n      children: [openForm && /*#__PURE__*/_jsxDEV(UsersForm, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 22\n      }, this), data && /*#__PURE__*/_jsxDEV(UsersList, {\n        data: data,\n        delegaciones: delegaciones,\n        grupos: grupos,\n        onUserDeactivate: handleDeactivate,\n        onhandleSetGroups: handleSetGroups,\n        onhandleSetDelegaciones: handleSetDelegaciones\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Loading, {\n      loading: !data,\n      message: LOADING(USERS.name)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Alert, {\n      open: errorOnGet || errorOnGetDelegaciones || errorOnGetGroup || error || info,\n      severity: info ? 'success' : 'error',\n      message: info ? info : error ? ERRORS[error](USERS.name) : ERRORS.onGet(USERS.name),\n      autoHideAfter: 3000,\n      onClose: function onClose() {\n        setError(null);\n        setInfo(null);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Users, \"dB4VYDuQ3nmxHssA6tVAd9EcUUY=\", false, function () {\n  return [useSWR, useSWR, useSWR];\n});\n\n_c = Users;\n\nvar _c;\n\n$RefreshReg$(_c, \"Users\");","map":{"version":3,"sources":["/reintegros/reintegros-frontend/components/users/Users.tsx"],"names":["Box","React","useState","useSWR","UsersForm","UsersList","AutorenewIcon","ERRORS","INFO","LOADING","USERS","ActionBar","patch","post","Loading","Alert","Users","data","errorOnGet","error","mutate","grupos","errorOnGetGroup","mutateGroup","delegaciones","errorOnGetDelegaciones","mutateDelegacion","openForm","setOpenForm","setError","info","setInfo","handleSetDelegaciones","delegacionesSelected","userId","setDelegaciones","handleSetGroups","groupsSelected","groups","setGroups","handleDeactivate","id","state","is_active","userActions","label","customActions","sync","onClick","res","onSync","name","count","icon","onGet"],"mappings":";;;;;;;;AAAA,SAASA,GAAT,QAA0D,mBAA1D;AACA,OAAOC,KAAP,IAAgBC,QAAhB,QAAgC,OAAhC;AACA,OAAOC,MAAP,MAAmB,KAAnB;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,OAAOC,aAAP,MAA0B,8BAA1B;AAEA,SAASC,MAAT,EAAiBC,IAAjB,EAAuBC,OAAvB,EAAgCC,KAAhC,QAA6C,cAA7C;AACA,OAAOC,SAAP,MAAsB,qBAAtB;AACA,SAASC,KAAT,EAAgBC,IAAhB,QAA4B,qBAA5B;AACA,OAAOC,OAAP,MAAoB,mBAApB;AACA,OAAOC,KAAP,MAAkB,iBAAlB;AAEA,eAAe,SAASC,KAAT,GAAiB;AAAA;;AAAA,gBACcb,MAAM,CAAC,cAAD,CADpB;AAAA,MACtBc,IADsB,WACtBA,IADsB;AAAA,MACTC,UADS,WAChBC,KADgB;AAAA,MACGC,MADH,WACGA,MADH;;AAAA,iBAEwCjB,MAAM,CAAC,aAAD,CAF9C;AAAA,MAEhBkB,MAFgB,YAEtBJ,IAFsB;AAAA,MAEDK,eAFC,YAERH,KAFQ;AAAA,MAEwBI,WAFxB,YAEgBH,MAFhB;;AAAA,iBAG0DjB,MAAM,CAC5F,mBAD4F,CAHhE;AAAA,MAGhBqB,YAHgB,YAGtBP,IAHsB;AAAA,MAGKQ,sBAHL,YAGFN,KAHE;AAAA,MAGqCO,gBAHrC,YAG6BN,MAH7B;;AAAA,kBAMElB,QAAQ,CAAC,KAAD,CANV;AAAA,MAMvByB,QANuB;AAAA,MAMbC,WANa;;AAAA,mBAOJ1B,QAAQ,CAAC,IAAD,CAPJ;AAAA,MAOvBiB,KAPuB;AAAA,MAOhBU,QAPgB;;AAAA,mBAQN3B,QAAQ,CAAC,IAAD,CARF;AAAA,MAQvB4B,IARuB;AAAA,MAQjBC,OARiB;;AAU9B,MAAMC,qBAAqB;AAAA,wEAAG,iBAAOC,oBAAP,EAA6BC,MAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEpBtB,KAAK,CAAC,cAAD,EAAiB;AAAEY,gBAAAA,YAAY,EAAES;AAAhB,eAAjB,EAAyDC,MAAzD,CAFe;;AAAA;AAG1BH,cAAAA,OAAO,CAACvB,IAAI,CAAC2B,eAAN,CAAP;AACAT,cAAAA,gBAAgB;AAJU;AAAA;;AAAA;AAAA;AAAA;AAM1BG,cAAAA,QAAQ,CAAC,mBAAD,CAAR;;AAN0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAArBG,qBAAqB;AAAA;AAAA;AAAA,KAA3B;;AAUA,MAAMI,eAAe;AAAA,yEAAG,kBAAOC,cAAP,EAAuBH,MAAvB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEdtB,KAAK,CAAC,cAAD,EAAiB;AAAE0B,gBAAAA,MAAM,EAAED;AAAV,eAAjB,EAA6CH,MAA7C,CAFS;;AAAA;AAGpBH,cAAAA,OAAO,CAACvB,IAAI,CAAC+B,SAAN,CAAP;AACAhB,cAAAA,WAAW;AAJS;AAAA;;AAAA;AAAA;AAAA;AAMpBM,cAAAA,QAAQ,CAAC,aAAD,CAAR;;AANoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAfO,eAAe;AAAA;AAAA;AAAA,KAArB;;AAUA,MAAMI,gBAAgB;AAAA,yEAAG,kBAAOC,EAAP,EAAmBC,KAAnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEf9B,KAAK,CAAC,cAAD,EAAiB;AAAE+B,gBAAAA,SAAS,EAAE,CAACD;AAAd,eAAjB,EAAwCD,EAAxC,CAFU;;AAAA;AAGrBrB,cAAAA,MAAM;AAHe;AAAA;;AAAA;AAAA;AAAA;AAKrBS,cAAAA,QAAQ,CAAC,cAAD,CAAR;;AALqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAH;;AAAA,oBAAhBW,gBAAgB;AAAA;AAAA;AAAA,KAAtB;;AAQA,MAAMI,WAAqB,GAAG,CAC5B;AACEC,IAAAA,KAAK,EAAEnC,KAAK,CAACoC,aAAN,CAAoBC,IAD7B;AAEEC,IAAAA,OAAO;AAAA,8EAAE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAEanC,IAAI,CAAC,qBAAD,EAAwB,EAAxB,CAFjB;;AAAA;AAECoC,gBAAAA,GAFD;AAGLlB,gBAAAA,OAAO,CAACvB,IAAI,CAAC0C,MAAL,CAAYxC,KAAK,CAACyC,IAAlB,qBAAwBF,GAAxB,aAAwBA,GAAxB,oCAAwBA,GAAG,CAAEhC,IAA7B,8CAAwB,UAAWmC,KAAnC,6DAA4C,CAA5C,CAAD,CAAP;AACAhC,gBAAAA,MAAM;AAJD;AAAA;;AAAA;AAAA;AAAA;AAMLS,gBAAAA,QAAQ,CAAC,QAAD,CAAR;;AANK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA,OAFT;AAWEwB,IAAAA,IAAI,eAAE,QAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAXR,GAD4B,CAA9B;AAgBA,sBACE;AAAA,4BACE,QAAC,SAAD;AAAW,MAAA,OAAO,EAAET;AAApB;AAAA;AAAA;AAAA;AAAA,YADF,eAEE,QAAC,GAAD;AAAK,MAAA,CAAC,EAAE,CAAR;AAAW,MAAA,CAAC,EAAE,CAAd;AAAiB,MAAA,MAAM,EAAC,mBAAxB;AAAA,iBACGjB,QAAQ,iBAAI,QAAC,SAAD;AAAA;AAAA;AAAA;AAAA,cADf,EAEGV,IAAI,iBACH,QAAC,SAAD;AACE,QAAA,IAAI,EAAEA,IADR;AAEE,QAAA,YAAY,EAAEO,YAFhB;AAGE,QAAA,MAAM,EAAEH,MAHV;AAIE,QAAA,gBAAgB,EAAEmB,gBAJpB;AAKE,QAAA,iBAAiB,EAAEJ,eALrB;AAME,QAAA,uBAAuB,EAAEJ;AAN3B;AAAA;AAAA;AAAA;AAAA,cAHJ;AAAA;AAAA;AAAA;AAAA;AAAA,YAFF,eAeE,QAAC,OAAD;AAAS,MAAA,OAAO,EAAE,CAACf,IAAnB;AAAyB,MAAA,OAAO,EAAER,OAAO,CAACC,KAAK,CAACyC,IAAP;AAAzC;AAAA;AAAA;AAAA;AAAA,YAfF,eAgBE,QAAC,KAAD;AACE,MAAA,IAAI,EAAEjC,UAAU,IAAIO,sBAAd,IAAwCH,eAAxC,IAA2DH,KAA3D,IAAoEW,IAD5E;AAEE,MAAA,QAAQ,EAAEA,IAAI,GAAG,SAAH,GAAe,OAF/B;AAGE,MAAA,OAAO,EAAEA,IAAI,GAAGA,IAAH,GAAUX,KAAK,GAAGZ,MAAM,CAACY,KAAD,CAAN,CAAcT,KAAK,CAACyC,IAApB,CAAH,GAA+B5C,MAAM,CAAC+C,KAAP,CAAa5C,KAAK,CAACyC,IAAnB,CAH7D;AAIE,MAAA,aAAa,EAAE,IAJjB;AAKE,MAAA,OAAO,EAAE,mBAAM;AACbtB,QAAAA,QAAQ,CAAC,IAAD,CAAR;AACAE,QAAAA,OAAO,CAAC,IAAD,CAAP;AACD;AARH;AAAA;AAAA;AAAA;AAAA,YAhBF;AAAA,kBADF;AA6BD;;GAnFuBf,K;UACsBb,M,EAC0BA,M,EACkBA,M;;;KAHlEa,K","sourcesContent":["import { Box, createStyles, Fab, makeStyles, Theme } from '@material-ui/core';\nimport React, { useState } from 'react';\nimport useSWR from 'swr';\nimport UsersForm from './UsersForm';\nimport UsersList from './UsersList';\nimport AutorenewIcon from '@material-ui/icons/Autorenew';\nimport { Action } from '../common/types/Action';\nimport { ERRORS, INFO, LOADING, USERS } from '../../labels';\nimport ActionBar from '../common/ActionBar';\nimport { patch, post } from '../api-call/service';\nimport Loading from '../common/Loading';\nimport Alert from '../common/Alert';\n\nexport default function Users() {\n  const { data, error: errorOnGet, mutate } = useSWR('api/usuarios');\n  const { data: grupos, error: errorOnGetGroup, mutate: mutateGroup } = useSWR('api/groups/');\n  const { data: delegaciones, error: errorOnGetDelegaciones, mutate: mutateDelegacion } = useSWR(\n    'api/delegaciones/',\n  );\n  const [openForm, setOpenForm] = useState(false);\n  const [error, setError] = useState(null);\n  const [info, setInfo] = useState(null);\n\n  const handleSetDelegaciones = async (delegacionesSelected, userId) => {\n    try {\n      await patch('api/usuarios', { delegaciones: delegacionesSelected }, userId);\n      setInfo(INFO.setDelegaciones);\n      mutateDelegacion();\n    } catch (error) {\n      setError('onSetDelegaciones');\n    }\n  };\n\n  const handleSetGroups = async (groupsSelected, userId) => {\n    try {\n      await patch('api/usuarios', { groups: groupsSelected }, userId);\n      setInfo(INFO.setGroups);\n      mutateGroup();\n    } catch (error) {\n      setError('onSetGroups');\n    }\n  };\n\n  const handleDeactivate = async (id: number, state: boolean) => {\n    try {\n      await patch('api/usuarios', { is_active: !state }, id);\n      mutate();\n    } catch (error) {\n      setError('onDeactivate');\n    }\n  };\n  const userActions: Action[] = [\n    {\n      label: USERS.customActions.sync,\n      onClick: async () => {\n        try {\n          const res = await post('api/ldap-sync-users', {});\n          setInfo(INFO.onSync(USERS.name, res?.data?.count ?? 0));\n          mutate();\n        } catch (error) {\n          setError('onSync');\n        }\n      },\n      icon: <AutorenewIcon />,\n    },\n  ];\n\n  return (\n    <>\n      <ActionBar actions={userActions} />\n      <Box p={2} m={1} border=\"1px solid #c4c4c4\">\n        {openForm && <UsersForm />}\n        {data && (\n          <UsersList\n            data={data}\n            delegaciones={delegaciones}\n            grupos={grupos}\n            onUserDeactivate={handleDeactivate}\n            onhandleSetGroups={handleSetGroups}\n            onhandleSetDelegaciones={handleSetDelegaciones}\n          />\n        )}\n      </Box>\n      <Loading loading={!data} message={LOADING(USERS.name)} />\n      <Alert\n        open={errorOnGet || errorOnGetDelegaciones || errorOnGetGroup || error || info}\n        severity={info ? 'success' : 'error'}\n        message={info ? info : error ? ERRORS[error](USERS.name) : ERRORS.onGet(USERS.name)}\n        autoHideAfter={3000}\n        onClose={() => {\n          setError(null);\n          setInfo(null);\n        }}\n      />\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}