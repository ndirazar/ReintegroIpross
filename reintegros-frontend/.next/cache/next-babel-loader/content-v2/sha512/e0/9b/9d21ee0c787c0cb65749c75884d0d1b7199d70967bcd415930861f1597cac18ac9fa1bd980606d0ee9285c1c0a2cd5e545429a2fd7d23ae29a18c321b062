{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useEffect, useState } from 'react';\nimport useSWR from 'swr';\nimport { Box } from '@material-ui/core'; //App imports\n\nimport SolicitudesList from './SolicitudesList';\nimport { remove, put, get } from '../api-call/service';\nimport useLoading from '../common/hooks/Loading';\nimport useAlert from '../common/hooks/Alert';\nimport { FormStepper } from './Stepper';\nimport { useForm, FormProvider } from 'react-hook-form';\nimport { ERRORS, PRESTACIONES, SOLICITUDES } from '../../labels';\nimport { objToQueryString, formatDate, getUser, strToDate, isUserCasaCentral, exportTableData } from '../common/helpers';\nimport { addDays, format, parseISO } from 'date-fns';\nimport TableFilters from '../common/TableFilters';\nimport filterConfig from './FiltersConfig'; // import Form from '../builder/Form';\n// import configPrestaciones from './prestaciones/FormConfig';\n\nimport Modal from '../common/Modal';\nimport { FormEditPrestaciones } from './prestaciones/FormEditPrestaciones';\nimport Alert from '../common/Alert';\nexport default function Solicitudes() {\n  var _user$delegacionPrinc;\n\n  var user = getUser();\n  var INITIAL_FILTER = {\n    page: 1,\n    size: 20,\n    delegacion: [isUserCasaCentral() ? '' : (user === null || user === void 0 ? void 0 : (_user$delegacionPrinc = user.delegacionPrincipal) === null || _user$delegacionPrinc === void 0 ? void 0 : _user$delegacionPrinc.id) || ''],\n    fecha_alta__gt: '',\n    fecha_alta__lt: ''\n  };\n\n  var _useState = useState(_objectSpread({}, INITIAL_FILTER)),\n      filters = _useState[0],\n      setFilters = _useState[1];\n\n  var _useState2 = useState(objToQueryString(filters)),\n      filterQueryStr = _useState2[0],\n      setFilterQueryStr = _useState2[1];\n\n  var _useSWR = useSWR(\"\".concat(SOLICITUDES.route, \"/?\") + filterQueryStr),\n      data = _useSWR.data,\n      errorGet = _useSWR.error,\n      mutate = _useSWR.mutate;\n\n  var _useState3 = useState(errorGet),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(null),\n      info = _useState4[0],\n      setInfo = _useState4[1];\n\n  var _React$useState = React.useState(false),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      showStepper = _React$useState2[0],\n      setShowStepper = _React$useState2[1];\n\n  var methods = useForm({\n    mode: 'onBlur'\n  });\n\n  var _useLoading = useLoading(),\n      isLoading = _useLoading.isLoading,\n      unsetLoading = _useLoading.unsetLoading;\n\n  var _useAlert = useAlert(),\n      addAlert = _useAlert.addAlert,\n      removeAlert = _useAlert.removeAlert;\n\n  var _useState5 = useState(false),\n      showFilters = _useState5[0],\n      setShowFilters = _useState5[1];\n\n  var _useState6 = useState(null),\n      editPrestacion = _useState6[0],\n      setEditPrestacion = _useState6[1];\n\n  var _useState7 = useState(false),\n      showEditPrestacion = _useState7[0],\n      setShowEditPrestacion = _useState7[1];\n\n  useEffect(function () {\n    if (!data) {\n      if (errorGet) {\n        unsetLoading();\n        addAlert(ERRORS.onGet(SOLICITUDES.name), 'error');\n      } else {\n        isLoading();\n      }\n    } else {\n      unsetLoading();\n\n      if (!error) {\n        removeAlert();\n      } else {\n        addAlert(error, 'error');\n      }\n    }\n  }, [data, errorGet, error]);\n\n  var handleDelete = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(id) {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return remove(\"\".concat(SOLICITUDES.route), id);\n\n            case 3:\n              _context.next = 8;\n              break;\n\n            case 5:\n              _context.prev = 5;\n              _context.t0 = _context[\"catch\"](0);\n              setError(ERRORS.onDeactivate(SOLICITUDES.name));\n\n            case 8:\n              mutate(\"\".concat(SOLICITUDES.route, \"?\") + filterQueryStr);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 5]]);\n    }));\n\n    return function handleDelete(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleShowStepper = function handleShowStepper() {\n    window.scrollTo(0, 0);\n    setShowStepper(true);\n  };\n\n  var handleFinished = function handleFinished() {\n    mutate(\"\".concat(SOLICITUDES.route, \"?\").concat(filterQueryStr));\n  };\n\n  var handleChangePagination = function handleChangePagination(pagination) {\n    setFilters(_objectSpread(_objectSpread({}, filters), {}, {\n      page: pagination.page,\n      size: pagination.pageSize\n    }));\n  };\n\n  var handleFilter = function handleFilter(filters) {\n    if (filters.fecha_alta__gt) {\n      filters.fecha_alta__gt = formatDate(filters.fecha_alta__gt);\n    } else {\n      delete filters.fecha_alta__gt;\n    }\n\n    if (filters.fecha_alta__lt) {\n      filters.fecha_alta__lt = formatDate(addDays(filters.fecha_alta__lt, 1));\n    } else {\n      delete filters.fecha_alta__lt;\n    }\n\n    setFilters(_objectSpread(_objectSpread({}, INITIAL_FILTER), filters));\n    setShowFilters(false);\n  };\n\n  var handleCancelFilter = function handleCancelFilter() {\n    setFilters(_objectSpread({}, INITIAL_FILTER));\n  };\n\n  var handleCloseFilter = function handleCloseFilter() {\n    setShowFilters(false);\n  };\n\n  var handleEditPrestacion = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(data) {\n      var _data$nomenclador, _data$nomenclador2, _data$nomenclador2$ca, _data$nomenclador3, _data$nomenclador3$ca, _data$nomenclador4, _data$nomenclador5, _data$nomenclador6, _data$nomenclador6$ca, _data$nomenclador7, _data$nomenclador7$ca, _data$nomenclador8, _data$prestador, _data$prestador2, _data$prestador3, _data$prestador4, _data$nomenclador9, _data$nomenclador10;\n\n      var valorIpross, montoTotal, cobertura, montoReintegrar, prestacion;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!data.auditoria) {\n                _context2.next = 3;\n                break;\n              }\n\n              addAlert(ERRORS.onAlreadyAudited(), 'error');\n              return _context2.abrupt(\"return\", false);\n\n            case 3:\n              valorIpross = (_data$nomenclador = data.nomenclador) === null || _data$nomenclador === void 0 ? void 0 : _data$nomenclador.valorIpross;\n              montoTotal = valorIpross * data.cantidad;\n              cobertura = data.cobertura;\n              montoReintegrar = (montoTotal * parseFloat(cobertura) / 100).toFixed(2);\n              prestacion = _objectSpread(_objectSpread({}, data), {}, {\n                capitulo: {\n                  label: (_data$nomenclador2 = data.nomenclador) === null || _data$nomenclador2 === void 0 ? void 0 : (_data$nomenclador2$ca = _data$nomenclador2.capitulo) === null || _data$nomenclador2$ca === void 0 ? void 0 : _data$nomenclador2$ca.descripcion,\n                  value: (_data$nomenclador3 = data.nomenclador) === null || _data$nomenclador3 === void 0 ? void 0 : (_data$nomenclador3$ca = _data$nomenclador3.capitulo) === null || _data$nomenclador3$ca === void 0 ? void 0 : _data$nomenclador3$ca.capitulo\n                },\n                nomenclador: {\n                  label: \"\".concat((_data$nomenclador4 = data.nomenclador) === null || _data$nomenclador4 === void 0 ? void 0 : _data$nomenclador4.codigo, \"-\").concat((_data$nomenclador5 = data.nomenclador) === null || _data$nomenclador5 === void 0 ? void 0 : _data$nomenclador5.descripcion, \" (\").concat((_data$nomenclador6 = data.nomenclador) === null || _data$nomenclador6 === void 0 ? void 0 : (_data$nomenclador6$ca = _data$nomenclador6.capitulo) === null || _data$nomenclador6$ca === void 0 ? void 0 : _data$nomenclador6$ca.capitulo, \"-\").concat((_data$nomenclador7 = data.nomenclador) === null || _data$nomenclador7 === void 0 ? void 0 : (_data$nomenclador7$ca = _data$nomenclador7.capitulo) === null || _data$nomenclador7$ca === void 0 ? void 0 : _data$nomenclador7$ca.descripcion, \")\"),\n                  value: (_data$nomenclador8 = data.nomenclador) === null || _data$nomenclador8 === void 0 ? void 0 : _data$nomenclador8.id\n                },\n                prestador: {\n                  label: \"\".concat((_data$prestador = data.prestador) === null || _data$prestador === void 0 ? void 0 : _data$prestador.matricula, \" - \").concat((_data$prestador2 = data.prestador) === null || _data$prestador2 === void 0 ? void 0 : _data$prestador2.nombre, \" \").concat((_data$prestador3 = data.prestador) === null || _data$prestador3 === void 0 ? void 0 : _data$prestador3.apellido),\n                  value: (_data$prestador4 = data.prestador) === null || _data$prestador4 === void 0 ? void 0 : _data$prestador4.id\n                },\n                modalidad: (_data$nomenclador9 = data.nomenclador) === null || _data$nomenclador9 === void 0 ? void 0 : _data$nomenclador9.modalidadPrestacion,\n                valorIprossNomenclador: (_data$nomenclador10 = data.nomenclador) === null || _data$nomenclador10 === void 0 ? void 0 : _data$nomenclador10.valorIpross,\n                montoReintegrar: montoReintegrar,\n                montoTotal: montoTotal.toFixed(2),\n                fechaPractica: strToDate(data.fechaPractica).toISOString(),\n                estadoActual: data.estadoActual || 'enCurso',\n                // unidad: data.nomenclador?.unidad,\n                periodo: data.periodo\n              });\n\n              if (data.fechaPractica && data.fechaPracticaHasta) {\n                prestacion.isDateRange = 'range';\n              } else {\n                prestacion.isDateRange = 'date';\n              }\n\n              setEditPrestacion(prestacion);\n              setShowEditPrestacion(true);\n\n            case 11:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleEditPrestacion(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleSubmitPrestacion = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(data) {\n      var _data$nomenclador11, _data$nomenclador12, _data$prestador5, _data$prestador6, _data$solicitud;\n\n      var prestacion;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              prestacion = _objectSpread(_objectSpread({}, data), {}, {\n                nomenclador: (_data$nomenclador11 = data.nomenclador) !== null && _data$nomenclador11 !== void 0 && _data$nomenclador11.value ? (_data$nomenclador12 = data.nomenclador) === null || _data$nomenclador12 === void 0 ? void 0 : _data$nomenclador12.value : data.nomenclador,\n                prestador: (_data$prestador5 = data.prestador) !== null && _data$prestador5 !== void 0 && _data$prestador5.value ? (_data$prestador6 = data.prestador) === null || _data$prestador6 === void 0 ? void 0 : _data$prestador6.value : data.prestador,\n                solicitud: (_data$solicitud = data.solicitud) === null || _data$solicitud === void 0 ? void 0 : _data$solicitud.id\n              });\n\n              if (data !== null && data !== void 0 && data.fechaPractica && typeof (data === null || data === void 0 ? void 0 : data.fechaPractica) === 'string') {\n                data.fechaPractica = parseISO(data.fechaPractica);\n              }\n\n              prestacion.fechaPractica = format(data === null || data === void 0 ? void 0 : data.fechaPractica, 'yyyy-MM-dd');\n\n              if (data !== null && data !== void 0 && data.fechaPracticaHasta) {\n                if (typeof (data === null || data === void 0 ? void 0 : data.fechaPracticaHasta) === 'string') {\n                  data.fechaPracticaHasta = parseISO(data.fechaPracticaHasta);\n                }\n\n                prestacion.fechaPracticaHasta = format(data === null || data === void 0 ? void 0 : data.fechaPracticaHasta, 'yyyy-MM-dd');\n              }\n\n              _context3.prev = 4;\n\n              if (!(data !== null && data !== void 0 && data.id)) {\n                _context3.next = 8;\n                break;\n              }\n\n              _context3.next = 8;\n              return put(PRESTACIONES.route, _objectSpread({}, prestacion), data.id);\n\n            case 8:\n              setError(null);\n              setEditPrestacion(null);\n              setInfo(SOLICITUDES.messages.successEditPrestacion);\n              mutate();\n              _context3.next = 17;\n              break;\n\n            case 14:\n              _context3.prev = 14;\n              _context3.t0 = _context3[\"catch\"](4);\n\n              if (data !== null && data !== void 0 && data.id) {\n                setError('onEdit');\n              }\n\n            case 17:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[4, 14]]);\n    }));\n\n    return function handleSubmitPrestacion(_x3) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    setFilterQueryStr(objToQueryString(filters));\n  }, [filters]);\n\n  var handleExport = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(allColumns, allData) {\n      var _yield$get, _yield$get$data;\n\n      var exportedData;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return get(\"\".concat(SOLICITUDES.route, \"/?\") + objToQueryString(_objectSpread(_objectSpread({}, filters), {}, {\n                size: data.count || 10000\n              })));\n\n            case 2:\n              _context4.t1 = _yield$get = _context4.sent;\n              _context4.t0 = _context4.t1 === null;\n\n              if (_context4.t0) {\n                _context4.next = 6;\n                break;\n              }\n\n              _context4.t0 = _yield$get === void 0;\n\n            case 6:\n              if (!_context4.t0) {\n                _context4.next = 10;\n                break;\n              }\n\n              _context4.t2 = void 0;\n              _context4.next = 11;\n              break;\n\n            case 10:\n              _context4.t2 = (_yield$get$data = _yield$get.data) === null || _yield$get$data === void 0 ? void 0 : _yield$get$data.results;\n\n            case 11:\n              exportedData = _context4.t2;\n              exportTableData('Solicitudes', allColumns, exportedData);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function handleExport(_x4, _x5) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var closeEditModal = function closeEditModal() {\n    setEditPrestacion(null);\n    setShowEditPrestacion(false);\n  };\n\n  return /*#__PURE__*/_jsxs(Box, {\n    style: {\n      position: 'relative'\n    },\n    children: [showStepper && /*#__PURE__*/_jsx(FormProvider, _objectSpread(_objectSpread({}, methods), {}, {\n      children: /*#__PURE__*/_jsx(FormStepper, {\n        setShowStepper: setShowStepper,\n        onFinished: handleFinished\n      })\n    })), editPrestacion && /*#__PURE__*/_jsx(Modal, {\n      customClasses: {},\n      open: showEditPrestacion,\n      onClose: closeEditModal,\n      title: SOLICITUDES.modalEditPrestacion.mainTitle,\n      breadcrumbs: '',\n      maxWidth: 'md',\n      children: /*#__PURE__*/_jsx(FormEditPrestaciones, {\n        prestacion: editPrestacion,\n        submit: handleSubmitPrestacion,\n        onCancel: closeEditModal\n      })\n    }), /*#__PURE__*/_jsx(SolicitudesList, {\n      data: data,\n      handleDelete: handleDelete,\n      onEdit: function onEdit() {},\n      onShowStepper: handleShowStepper,\n      onPaginationChange: handleChangePagination,\n      onFilter: function onFilter() {\n        setShowFilters(true);\n      },\n      onEditPrestacion: function onEditPrestacion(p) {\n        handleEditPrestacion(p);\n      },\n      onExport: handleExport\n    }), /*#__PURE__*/_jsx(TableFilters, {\n      config: filterConfig,\n      data: filters,\n      onSubmit: handleFilter,\n      onCancel: handleCancelFilter,\n      onClose: handleCloseFilter,\n      show: showFilters\n    }), /*#__PURE__*/_jsx(Alert, {\n      open: error || info,\n      severity: info ? 'success' : 'error',\n      message: info ? info : error ? ERRORS[error](SOLICITUDES.name) : ERRORS.onGet(SOLICITUDES.name),\n      autoHideAfter: 5500,\n      onClose: function onClose() {\n        setError(null);\n        setInfo(null);\n      }\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}