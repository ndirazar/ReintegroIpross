{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/reintegros/reintegros-frontend/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Box, Typography } from '@material-ui/core';\nimport React, { useEffect, useState } from 'react';\nimport useSWR from 'swr';\nimport CuponesList from './CuponesList';\nimport { get, send } from '../api-call/service';\nimport Loading from '../common/Loading';\nimport { ERRORS, LOADING, CUPONES } from '../../labels';\nimport Alert from '../common/Alert';\nimport ActionBar from '../common/ActionBar';\nimport { objToQueryString, formatDate, getUser, isUserCasaCentral, exportTableData } from '../common/helpers';\nimport Modal from '../common/Modal';\nimport filterConfig from './FiltersConfig';\nimport TableFilters from '../common/TableFilters';\nimport ConfirmDialog from '../common/ConfirmDialog';\nexport default function Cupones() {\n  var _user$delegacionPrinc;\n\n  var user = getUser();\n  var INITIAL_FILTER = {\n    page: 1,\n    size: 20,\n    delegacion: isUserCasaCentral() ? '' : (user === null || user === void 0 ? void 0 : (_user$delegacionPrinc = user.delegacionPrincipal) === null || _user$delegacionPrinc === void 0 ? void 0 : _user$delegacionPrinc.id) || '',\n    fecha_alta__gt: '',\n    fecha_alta__lt: '',\n    capitulo: '',\n    nroLote: '',\n    estado: 'abierto'\n  };\n\n  var _useState = useState(_objectSpread({}, INITIAL_FILTER)),\n      filters = _useState[0],\n      setFilters = _useState[1];\n\n  var _useState2 = useState(objToQueryString(filters)),\n      filterQueryStr = _useState2[0],\n      setFilterQueryStr = _useState2[1];\n\n  var _useSWR = useSWR(\"\".concat(CUPONES.route, \"/?\").concat(filterQueryStr)),\n      data = _useSWR.data,\n      errorGet = _useSWR.error,\n      mutate = _useSWR.mutate;\n\n  var _useState3 = useState(null),\n      error = _useState3[0],\n      setError = _useState3[1];\n\n  var _useState4 = useState(null),\n      openModalSetState = _useState4[0],\n      setOpenModalSetState = _useState4[1];\n\n  var _useState5 = useState(null),\n      cuponToUpdate = _useState5[0],\n      setCuponToUpdate = _useState5[1];\n\n  var _useState6 = useState(null),\n      info = _useState6[0],\n      setInfo = _useState6[1];\n\n  var _useState7 = useState(false),\n      showFilters = _useState7[0],\n      setShowFilters = _useState7[1];\n\n  var _useState8 = useState(false),\n      showConfirmDialog = _useState8[0],\n      setShowConfirmDialog = _useState8[1];\n\n  var _useState9 = useState(null),\n      cuponesToDelete = _useState9[0],\n      setCuponesToDelete = _useState9[1];\n\n  var handleChangePagination = function handleChangePagination(pagination) {\n    setFilters(_objectSpread(_objectSpread({}, filters), {}, {\n      page: pagination.page,\n      size: pagination.pageSize\n    }));\n  };\n\n  var handleFilter = function handleFilter(newFilters) {\n    if (newFilters.fecha_alta__gt) {\n      newFilters.fecha_alta__gt = formatDate(newFilters.fecha_alta__gt);\n    } else {\n      delete newFilters.fecha_alta__gt;\n    }\n\n    if (newFilters.fecha_alta__lt) {\n      newFilters.fecha_alta__lt = formatDate(newFilters.fecha_alta__lt);\n    } else {\n      delete newFilters.fecha_alta__lt;\n    }\n\n    if (!newFilters.nroLote || isNaN(newFilters.nroLote)) {\n      delete newFilters.nroLote;\n    }\n\n    setFilters(newFilters);\n    setShowFilters(false);\n  };\n\n  var handleCancelFilter = function handleCancelFilter() {\n    setFilters(_objectSpread({}, INITIAL_FILTER));\n    setShowFilters(false);\n  };\n\n  var handleSetState = function handleSetState(stateSelected, cupon) {\n    setCuponToUpdate(cupon);\n    setOpenModalSetState(true);\n  };\n\n  var handleConfirmModal = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return send({\n                url: \"api/cupon/\".concat(cuponToUpdate.id, \"/reabrir\"),\n                method: 'PUT',\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 3:\n              setInfo(CUPONES.messages.successReopenCupones);\n              mutate();\n              _context.next = 10;\n              break;\n\n            case 7:\n              _context.prev = 7;\n              _context.t0 = _context[\"catch\"](0);\n              setError('onEditStateCupon');\n\n            case 10:\n              setOpenModalSetState(false);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 7]]);\n    }));\n\n    return function handleConfirmModal() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleCancelModal = function handleCancelModal() {\n    setOpenModalSetState(false);\n  };\n\n  var handleOnCreate = function handleOnCreate() {\n    mutate(\"\".concat(CUPONES.route, \"/?\").concat(filterQueryStr));\n  };\n\n  var handleOnRemove = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(cupones) {\n      var ids;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              setShowConfirmDialog(true);\n              ids = cupones.map(function (cup) {\n                return cup.id;\n              });\n              setCuponesToDelete(ids);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function handleOnRemove(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleConfirmDelete = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var response;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setShowConfirmDialog(false);\n              _context3.prev = 1;\n              _context3.next = 4;\n              return send({\n                url: \"\".concat(CUPONES.route, \"/quitar\"),\n                data: {\n                  cupones: _toConsumableArray(cuponesToDelete)\n                },\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'multipart/form-data'\n                }\n              });\n\n            case 4:\n              response = _context3.sent;\n              mutate(\"\".concat(CUPONES.route, \"/?\").concat(filterQueryStr));\n              _context3.next = 11;\n              break;\n\n            case 8:\n              _context3.prev = 8;\n              _context3.t0 = _context3[\"catch\"](1);\n              setError('onEditStateCupon');\n\n            case 11:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[1, 8]]);\n    }));\n\n    return function handleConfirmDelete() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleExport = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(allColumns, allData) {\n      var _yield$get, _yield$get$data;\n\n      var exportedData;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return get(\"\".concat(CUPONES.route, \"/?\") + objToQueryString(_objectSpread(_objectSpread({}, filters), {}, {\n                size: data.count || 10000\n              })));\n\n            case 2:\n              _context4.t1 = _yield$get = _context4.sent;\n              _context4.t0 = _context4.t1 === null;\n\n              if (_context4.t0) {\n                _context4.next = 6;\n                break;\n              }\n\n              _context4.t0 = _yield$get === void 0;\n\n            case 6:\n              if (!_context4.t0) {\n                _context4.next = 10;\n                break;\n              }\n\n              _context4.t2 = void 0;\n              _context4.next = 11;\n              break;\n\n            case 10:\n              _context4.t2 = (_yield$get$data = _yield$get.data) === null || _yield$get$data === void 0 ? void 0 : _yield$get$data.results;\n\n            case 11:\n              exportedData = _context4.t2;\n              exportTableData('Solicitudes-autorizadas', allColumns, exportedData);\n\n            case 13:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4);\n    }));\n\n    return function handleExport(_x2, _x3) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    setFilterQueryStr(objToQueryString(filters));\n  }, [filters]);\n  return /*#__PURE__*/_jsxs(_Fragment, {\n    children: [/*#__PURE__*/_jsx(ActionBar, {\n      actions: []\n    }), /*#__PURE__*/_jsxs(Box, {\n      p: 2,\n      m: 1,\n      style: {\n        position: 'relative'\n      },\n      children: [/*#__PURE__*/_jsx(CuponesList, {\n        data: data,\n        onPaginationChange: handleChangePagination,\n        onHandleSetState: handleSetState,\n        onFilter: function onFilter() {\n          setShowFilters(!showFilters);\n        },\n        filters: filters,\n        onCreate: handleOnCreate,\n        onRemove: handleOnRemove,\n        onExport: handleExport\n      }), /*#__PURE__*/_jsx(TableFilters, {\n        config: filterConfig,\n        data: filters,\n        onSubmit: handleFilter,\n        onCancel: handleCancelFilter,\n        show: showFilters\n      })]\n    }), openModalSetState && /*#__PURE__*/_jsxs(Modal, {\n      customClasses: {},\n      open: true,\n      onClose: function onClose() {\n        return setOpenModalSetState(!openModalSetState);\n      },\n      title: CUPONES.modalSetState.mainTitle,\n      breadcrumbs: '',\n      subTitle: false,\n      actions: true,\n      onAcept: handleConfirmModal,\n      onCancel: handleCancelModal,\n      maxWidth: 'md',\n      children: [/*#__PURE__*/_jsx(Typography, {\n        children: CUPONES.modalSetState.subTitle1\n      }), /*#__PURE__*/_jsx(Typography, {\n        children: CUPONES.modalSetState.subTitle2\n      }), /*#__PURE__*/_jsx(Typography, {\n        children: CUPONES.modalSetState.subTitle3(cuponToUpdate)\n      }), /*#__PURE__*/_jsx(Typography, {\n        children: CUPONES.modalSetState.subTitle4\n      })]\n    }), /*#__PURE__*/_jsx(ConfirmDialog, {\n      open: showConfirmDialog,\n      onConfirm: handleConfirmDelete,\n      onClose: function onClose() {\n        setCuponesToDelete(null);\n        setShowConfirmDialog(false);\n      },\n      message: CUPONES.messages.deleteMessage\n    }), /*#__PURE__*/_jsx(Loading, {\n      loading: !data,\n      message: LOADING(CUPONES.name)\n    }), /*#__PURE__*/_jsx(Alert, {\n      open: !!errorGet || !!error || !!info,\n      severity: !!info ? 'success' : 'error',\n      message: !!info ? info : !!error ? ERRORS[error](CUPONES.name) : ERRORS.onGet(CUPONES.name)\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}